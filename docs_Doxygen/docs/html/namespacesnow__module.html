<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>SUEWS: snow_module Module Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SUEWS
   </div>
   <div id="projectbrief">SUEWS: Surface Urban Energy and Water Balance Scheme</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions/Subroutines</a>  </div>
  <div class="headertitle">
<div class="title">snow_module Module Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions/Subroutines</h2></td></tr>
<tr class="memitem:a2a6602c576a01060981a378d086ec075"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a2a6602c576a01060981a378d086ec075">snow_cal_meltheat</a> (snowUse, lvS_J_kg, lv_J_kg, tstep_real, RadMeltFact, TempMeltFact, SnowAlbMax, SnowDensMin, Temp_C, Precip, PrecipLimit, PrecipLimitAlb, nsh_real, sfr, Tsurf_ind, Tsurf_ind_snow, state_id, qn1_ind_snow, kup_ind_snow, SnowWater, deltaQi, SnowPack, snowFrac, SnowAlb, SnowDens, SnowfallCum, mwh, fwh, Qm, QmFreez, QmRain, veg_fr, snowCalcSwitch, Qm_melt, Qm_freezState, Qm_rain, FreezMelt, FreezState, FreezStateVol, rainOnSnow, SnowDepth, mw_ind, dataOutLineSnow)</td></tr>
<tr class="separator:a2a6602c576a01060981a378d086ec075"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2c8faa2ca21ff3ca8cab3f7b10caf66f"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a2c8faa2ca21ff3ca8cab3f7b10caf66f">meltheat</a> (bldgsurf, nsurf, PavSurf, WaterSurf, lvS_J_kg, lv_J_kg, tstep_real, RadMeltFact, TempMeltFact, SnowAlbMax, SnowDensMin, Temp_C, Precip, PrecipLimit, PrecipLimitAlb, nsh_real, waterdens, sfr, Tsurf_ind, state_id, qn1_ind_snow, SnowWater, deltaQi, SnowPack, snowFrac, SnowAlb, SnowDens, SnowfallCum, mwh, fwh, Qm, QmFreez, QmRain, snowCalcSwitch, Qm_melt, Qm_freezState, Qm_rain, FreezMelt, FreezState, FreezStateVol, rainOnSnow, SnowDepth, mw_ind)</td></tr>
<tr class="separator:a2c8faa2ca21ff3ca8cab3f7b10caf66f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a984d66c788d944a28a5964badb0b1df1"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a984d66c788d944a28a5964badb0b1df1">snowcalc</a> (tstep, imin, it, dectime, is, EvapMethod, CRWmin, CRWmax, nsh_real, lvS_J_kg, lv_j_kg, avdens, avRh, Press_hPa, Temp_C, RAsnow, psyc_hPa, avcp, sIce_hPa, PervFraction, vegfraction, addimpervious, vpd_hPa, qn_e, s_hPa, ResistSurf, RA, rb, tlv, snowdensmin, SnowProf_24hr, precip, PipeCapacity, RunoffToWater, addVeg, SnowLimPaved, SnowLimBldg, FlowChange, drain, WetThresh, stateOld, mw_ind, SoilStoreCap, rainonsnow, freezmelt, freezstate, freezstatevol, Qm_Melt, Qm_rain, Tsurf_ind, sfr, dayofWeek_id, StoreDrainPrm, SnowPackLimit, AddWater, addwaterrunoff, soilstore_id, SnowPack, SurplusEvap, snowFrac, SnowWater, iceFrac, SnowDens, runoffAGimpervious, runoffAGveg, surplusWaterBody, rss_nsurf, runoffSnow, runoff, runoffSoil, chang, changSnow, SnowToSurf, state_id, ev_snow, SnowDepth, SnowRemoval, swe, ev, chSnow_tot, ev_tot, qe_tot, runoff_tot, surf_chang_tot, runoffPipes, mwstore, runoffwaterbody)</td></tr>
<tr class="separator:a984d66c788d944a28a5964badb0b1df1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a52917059a2a85dcf9bf0d4f92bde6ba7"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a52917059a2a85dcf9bf0d4f92bde6ba7">evap_suews_snow</a> (Qm, QP, lvS_J_kg, avdens, avRh, Press_hPa, Temp_C, RAsnow, psyc_hPa, tstep, avcp, sIce_hPa, dectime, ev_snow, tlv_sub)</td></tr>
<tr class="separator:a52917059a2a85dcf9bf0d4f92bde6ba7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a64ee5568c224c9861096d3a094032a33"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a64ee5568c224c9861096d3a094032a33">snowrem</a> (is, PavSurf, BldgSurf, nsurf, snowfrac, sfr, SnowPack, SnowRemoval, SnowLimPaved, SnowLimBldg)</td></tr>
<tr class="separator:a64ee5568c224c9861096d3a094032a33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3574cc96d5500ebbcc98deedd05c5081"><td class="memItemLeft" align="right" valign="top">real(kind(1d0)) function&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a3574cc96d5500ebbcc98deedd05c5081">snowdepletioncurve</a> (is, swe, sweD)</td></tr>
<tr class="separator:a3574cc96d5500ebbcc98deedd05c5081"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06e219e41fda843664a95853a632ec11"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#a06e219e41fda843664a95853a632ec11">veg_fr_snow</a> (sfr, snowFrac, nsurf, veg_fr)</td></tr>
<tr class="separator:a06e219e41fda843664a95853a632ec11"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab714d5ea93ac72f7826b043c6d1bf790"><td class="memItemLeft" align="right" valign="top">subroutine&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespacesnow__module.html#ab714d5ea93ac72f7826b043c6d1bf790">snowupdate</a> (nsurf, tstep, Temp_C_hr, tau_a, tau_f, tau_r, SnowDensMax, SnowDensMin, SnowAlbMax, SnowAlbMin, SnowPack, SnowAlb, SnowDens)</td></tr>
<tr class="separator:ab714d5ea93ac72f7826b043c6d1bf790"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function/Subroutine Documentation</h2>
<a id="a52917059a2a85dcf9bf0d4f92bde6ba7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a52917059a2a85dcf9bf0d4f92bde6ba7">&#9670;&nbsp;</a></span>evap_suews_snow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::evap_suews_snow </td>
          <td>(</td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Qm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>QP</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lvS_J_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>avdens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>avRh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Press_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Temp_C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>RAsnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>psyc_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>tstep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>avcp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>sIce_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>dectime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>ev_snow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>tlv_sub</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l01128">1128</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160; </div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacemeteo.html">meteo</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacemeteo.html#ad97f553e69dd6efff67ba4cafdbb02f2">sat_vap_pressice</a></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160; </div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160; </div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;      <span class="comment">!INPUT</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Qm        <span class="comment">!melt heat,</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::QP        <span class="comment">!advect. heat</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lvS_J_kg  <span class="comment">!latent heat of sublimation</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::avdens    <span class="comment">!air density</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::avRh      <span class="comment">!relative humidity</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Press_hPa <span class="comment">!air pressure</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Temp_C    <span class="comment">!air temperature</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::RAsnow    <span class="comment">!aerodyn res snow</span></div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::psyc_hPa  <span class="comment">!psychometric constant</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::avcp      <span class="comment">!spec. heat,</span></div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::sIce_hPa  <span class="comment">!satured curve on snow</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::dectime</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>:: tstep</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160; </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::ev_snow    <span class="comment">!Evaporation</span></div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::tlv_sub    <span class="comment">!Latent heat for sublimation</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160; </div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;      <span class="comment">!OTHER VARIABLES</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::e_snow, &amp;     <span class="comment">!PM equation obe line</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;                        sae_snow, &amp;   <span class="comment">!s * (Available energy)</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                        qe_snow, &amp;    <span class="comment">!Latent heat flux</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                        vdrcice, &amp;    <span class="comment">!Vapour pressure deficit</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                        esice_hpa, &amp;  <span class="comment">!Saturation vapor pressure over ice</span></div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                        eaice_hpa, &amp;  <span class="comment">!Vapour pressure</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                        <a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>   <span class="comment">!timestep as real</span></div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160; </div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;      <span class="keywordtype">INTEGER</span>::from = 1</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;      <span class="comment">!-----------------------------------------------------</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160; </div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;      <a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a> = real(<a class="code" href="namespacesues__data.html#ac6af955be55f5fe026b4ba1ab6ec480e">tstep</a>, kind(1d0))</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;      sae_snow = <a class="code" href="namespacemoist.html#af9212d0e505f0524f70140ff2108f745">sice_hpa</a>*(qp - <a class="code" href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">qm</a>)   <span class="comment">!Calculate the driving parameter in calculation of evaporation. JÃ¤rvi et al. (2015)</span></div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160; </div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;      esice_hpa = <a class="code" href="namespacemeteo.html#ad97f553e69dd6efff67ba4cafdbb02f2">sat_vap_pressice</a>(temp_c, press_hpa, from, <a class="code" href="namespacetime.html#acf0bd1b102769fcbe36a171b4b9e2a25">dectime</a>) <span class="comment">!Saturation vapor pressure over ice</span></div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;      eaice_hpa = avrh/100*esice_hpa                       <span class="comment">!Vapour pressure of water</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;      vdrcice = (esice_hpa - eaice_hpa)*avdens*<a class="code" href="namespacemoist.html#a0b90f7e6761869efa414063f6ef84f6f">avcp</a>          <span class="comment">!Vapour pressure deficit</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;      <a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a> = <a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a>/<a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>                        <span class="comment">!Latent heat for sublimation</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;      e_snow = sae_snow + vdrcice/<a class="code" href="namespacesues__data.html#abe3d3d6bafc04802fe09ca8fd7a5ebb6">rasnow</a>                     <span class="comment">!PM equation</span></div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;      qe_snow = e_snow/(<a class="code" href="namespacemoist.html#af9212d0e505f0524f70140ff2108f745">sice_hpa</a> + <a class="code" href="namespacemoist.html#a5a7cfba4c3c7fd580026b89d923b61df">psyc_hpa</a>)                 <span class="comment">!Latent heat (W/m^2)</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;      ev_snow = qe_snow/<a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a>                            <span class="comment">!Evaporation (in mm)</span></div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160; </div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;      <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="suews__util__meteo_8f95_source.html#l00196">meteo::sat_vap_pressice()</a>.</p>

<p class="reference">Referenced by <a class="el" href="suews__phys__snow_8f95_source.html#l00469">snowcalc()</a>.</p>

</div>
</div>
<a id="a2c8faa2ca21ff3ca8cab3f7b10caf66f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c8faa2ca21ff3ca8cab3f7b10caf66f">&#9670;&nbsp;</a></span>meltheat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::meltheat </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>bldgsurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>PavSurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>WaterSurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lvS_J_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lv_J_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>tstep_real</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>RadMeltFact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>TempMeltFact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowAlbMax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowDensMin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Temp_C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Precip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>PrecipLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>PrecipLimitAlb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>nsh_real</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>waterdens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>Tsurf_ind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>state_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>qn1_ind_snow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>SnowWater</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>deltaQi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowPack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>snowFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowAlb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowDens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowfallCum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>mwh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>fwh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>Qm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>QmFreez</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>QmRain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>snowCalcSwitch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>Qm_melt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>Qm_freezState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>Qm_rain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>FreezMelt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>FreezState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>FreezStateVol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>rainOnSnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>SnowDepth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>mw_ind</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l00207">207</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160; </div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="comment">!These are input to the module</span></div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::bldgsurf</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::nsurf</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::PavSurf</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::WaterSurf</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lvS_J_kg</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lv_J_kg</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::tstep_real</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::RadMeltFact</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::TempMeltFact</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::SnowAlbMax</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::SnowDensMin</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Temp_C</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Precip</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::PrecipLimit</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::PrecipLimitAlb</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::nsh_real</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::waterdens</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::sfr</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::Tsurf_ind</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::state_id</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::qn1_ind_snow</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::SnowWater</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::deltaQi</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160; </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;      <span class="comment">!Input and output as this is updated in this subroutine</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowPack</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::snowFrac</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::SnowAlb</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowDens</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::SnowfallCum</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160; </div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      <span class="comment">!Output:</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::mwh</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::fwh</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::Qm</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::QmFreez</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::QmRain</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160; </div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;      <span class="comment">!Output, dimension nsurf</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::snowCalcSwitch</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160; </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::Qm_melt</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::Qm_freezState</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::Qm_rain</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::FreezMelt</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::FreezState</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::FreezStateVol</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::rainOnSnow</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::SnowDepth</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::mw_ind</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;      <span class="comment">! local variables:</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::AdjMeltFact</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::Watfreeze</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">PARAMETER</span>::cw = 4190  <span class="comment">!,ci=2090   !Specific heat capacity of water</span></div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <span class="keywordtype">INTEGER</span>::is, xx</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160; </div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;      <span class="comment">!Initialize snow variables</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;      <a class="code" href="namespacesnowmod.html#a8a86e8b1f4de8e8447c4fc264c910bd4">mwh</a> = 0 <span class="comment">!Initialize snow melt and heat related to snowmelt</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;      <a class="code" href="namespacesnowmod.html#a17abf76009d5444c277c504419efacdd">fwh</a> = 0</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;      <a class="code" href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">qm</a> = 0</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;      <a class="code" href="namespacesnowmod.html#a593cb8d2d82b6e80d07831e94c2013dc">qmfreez</a> = 0</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;      <a class="code" href="namespacesnowmod.html#a53e675abb512cd7e7ee673dd03911a54">qmrain</a> = 0</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;      snowcalcswitch = 0</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;      qm_melt = 0</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;      qm_freezstate = 0</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      qm_rain = 0</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      freezmelt = 0</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      freezstate = 0</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      freezstatevol = 0</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      rainonsnow = 0</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      snowdepth = 0</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      mw_ind = 0</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="comment">!===dummy calculations===</span></div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      xx = bldgsurf</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      xx = pavsurf</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;      <span class="comment">!===dummy calculations end===</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160; </div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;      <span class="comment">!=========================================================================================</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> = 1, nsurf  <span class="comment">!Go each surface type through</span></div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;         <span class="keywordflow">IF</span> (sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) /= 0) <span class="keywordflow">THEN</span>  <span class="comment">!If surface type existing,</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span>  <span class="comment">!If SnowPack existing, calculate meltwater related water flows</span></div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160; </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;               snowdepth(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/1000)*<a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>/snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">) !Snow depth in m</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160; </div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;               <span class="comment">!Calculate meltwater related water flows with hourly degree-day method.</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160; </div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;               <span class="comment">!These are for snow melting</span></div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;               <span class="keywordflow">IF</span> (temp_c &gt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                  <span class="keywordflow">IF</span> (qn1_ind_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                     mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#a7243763d809e4a91d9098fbdafe567ff">tempmeltfact</a>*temp_c             <span class="comment">!(mm Câˆ’1 hâˆ’1)*(C) = in mm h-1</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                  <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                     mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#a37a51eae2e92c0d594b8f2acbf8e2a7c">radmeltfact</a>*(qn1_ind_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))  <span class="comment">!(mm m2 Wâˆ’1 hâˆ’1)*(W m-2)= mm h-1 ??</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;               <span class="keywordflow">ELSE</span>  <span class="comment">!Freezing equations</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                  <a class="code" href="namespacesnowmod.html#a2f655017a75f9dc31500f86bbd985399">adjmeltfact</a> = 1  <span class="comment">!Relationship between the temperature melt and freezing factors</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;                  mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#a7243763d809e4a91d9098fbdafe567ff">tempmeltfact</a>*temp_c*<a class="code" href="namespacesnowmod.html#a2f655017a75f9dc31500f86bbd985399">adjmeltfact</a> <span class="comment">! in mm h-1</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;               <span class="comment">!Previous equation give the hourly values, divide these with the timestep number</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;               mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;               <span class="keywordflow">IF</span> (mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)<span class="comment">!Limited by the previous timestep SnowPack</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;               <span class="comment">!-----------------------------------------------------</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;               <span class="comment">! Heat consumed to snowmelt/refreezing within Tstep.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;               <span class="comment">! Converted from mm nsh-1 to mm nsh-1 and to m s-1</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;               qm_melt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>*((mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/<a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>)/1000)*(<a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a><span class="comment"> - <a class="code" href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">lv_j_kg</a>)</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;               <span class="comment">!If melt is negative this means freezing water in the SnowPack</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;               <span class="keywordflow">IF</span> (mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                  freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = -mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!Save this to variable FreezMelt</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                  mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                  <span class="comment">!Freezing water cannot exceed meltwater store</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                  <span class="keywordflow">IF</span> (freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                  <span class="comment">!Recalculate melt related energy</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                  qm_melt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>*((-freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/<a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>)/1<span class="comment">000)*(<a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a> - <a class="code" href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">lv_j_kg</a>)</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;<span class="comment"></span><span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;               <span class="comment">!-----------------------------------------------------</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;               <span class="comment">! If air temperature is above zero, precipitation causes advective heat to the</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;               <span class="comment">! SnowPack. Eq (23) in Sun et al., 1999</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;               <span class="comment">! Calculation done at resolution of the model timestep</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;               <span class="keywordflow">IF</span> (temp_c &gt;= <a class="code" href="namespacesnowmod.html#af5f7c82ab6625c3e67be5fac8829bcd2">preciplimit</a> .AND. precip &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                  qm_rain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>*cw*(temp_c - <a class="code" href="namespacesnowmod.html#af5f7c82ab6625c3e67be5fac8829bcd2">preciplimit</a>)*(precip<span class="comment">*0.001/<a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>)  !in W m-2</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                  <span class="keywordflow">IF</span> (qm_rain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span> <span class="comment">!Can only be positive</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                     qm_rain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                  <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                     rainonsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = precip <span class="comment">!Save information on the rain on snow event</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;<span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160; </div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="keywordflow">            ENDIF</span> <span class="comment">!End if SnowPack</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160; </div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="comment">!=================================================================</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160; </div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="comment">!Freeze surface water state_id if cold enough.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            <span class="keywordflow">IF</span> (tsurf_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0 .AND. state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;               snowcalcswitch(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 1 <span class="comment">!If water on ground this forms ice and snow calculations are made</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160; </div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;               <span class="comment">!Other surfaces than water treated first</span></div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;               <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> /= watersurf) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                  <span class="comment">!FreezState(is) = state_id(is)</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                  <span class="comment">!Previously all state_id could freeze in 5-min timestep. Now we calculate how much water</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                  <span class="comment">!can freeze in a timestep based on the same temperature freezing fraction.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                  freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = -<a class="code" href="namespacesnowmod.html#a7243763d809e4a91d9098fbdafe567ff">tempmeltfact</a>*tsurf_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160; </div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                  <span class="comment">!The amount of freezing water cannot be greater than the surface state_id</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                  <span class="keywordflow">IF</span> (freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = state_id<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                  <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == 0 .OR. snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == 0) <span class="keywordflow">THEN</span> <span class="comment">!SnowPack forms</span></div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                     freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                  <span class="keywordflow">ELSE</span>                                         <span class="comment">!There is snow already on ground</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                     freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">))/snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;<span class="comment"></span><span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                  <span class="comment">! If the amount of freezing water is very small and there is state_id left to the ground</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                  <span class="comment">! no freezing of water will take place</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                  <span class="keywordflow">IF</span> (freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0.00000000001 .AND. freezstate<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) </span><span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                     freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                     freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="keywordflow">                  ENDIF</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160; </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                  <span class="comment">!Calculate the heat exchange in W m-2</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                  qm_freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = -<a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>*(freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/<a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a><span class="comment">/1000)*(<a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a> - <a class="code" href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">lv_j_kg</a>)</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                  <span class="comment">!Water surface separately</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;               <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                  <span class="comment">!Calculate average value how much water can freeze above the water areas</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;                  <span class="comment">!Equation is -hA(T-T0) = rhoV(Cp+dT +Lf) in 5-min timestep</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                  <span class="comment">!h=convective heat trasnfer,A, area of water,rwo water density,V volume, dT temperature difference</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;                  <span class="comment">!before and end of the 5-min period. dT equals zero, h=100 and when multiplied with Area, the equation</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                  <span class="comment">!simplyfies to the this. LJ 14 July 2015</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                  watfreeze = 100*(0 - temp_c)/(<a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>*(<a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a> - <a class="code" href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">lv_j_kg</a><span class="comment">))</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment"></span>                  freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = watfreeze</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                  qm_freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = -<a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>*(watfreeze/<a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>/1<span class="comment">000)*(<a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a> - <a class="code" href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">lv_j_kg</a>)</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment"></span><span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160; </div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160; </div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            <span class="comment">!======================================================================</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="comment">! Define if any snowmelt calculations are made: SnowPack existing,</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="comment">! freezing occuring on ground or from precip</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> /= watersurf) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;               <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0 .OR. (precip &gt; 0 .AND. tsurf_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)<span class="comment"> &lt; 0)) </span><span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                  snowcalcswitch(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 1</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;<span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <span class="keywordflow">ELSE</span>       <span class="comment">!Water surface separately</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;               <span class="keywordflow">IF</span> (snowpack(watersurf) &gt; 0 .OR. freezstate(watersurf) &gt; <span class="comment">0) </span><span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                  snowcalcswitch(watersurf) = 1</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;<span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160; </div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="comment">!Update snow density of each surface</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">IF</span> (precip &gt; 0 .AND. tsurf_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0 .AND. snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; <span class="comment">0) </span><span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;               snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/(snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + precip<span class="comment">) + <a class="code" href="namespacesnowmod.html#aa8834b111a576d48e70825463fae599f">snowdensmin</a>*precip/(snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + precip)</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="comment"></span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            <span class="comment">!Weighted variables for the whole area</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;            <a class="code" href="namespacesnowmod.html#a8a86e8b1f4de8e8447c4fc264c910bd4">mwh</a> = <a class="code" href="namespacesnowmod.html#a8a86e8b1f4de8e8447c4fc264c910bd4">mwh</a> + mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)        <span class="comment">!Snowmelt</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <a class="code" href="namespacesnowmod.html#a17abf76009d5444c277c504419efacdd">fwh</a> = <a class="code" href="namespacesnowmod.html#a17abf76009d5444c277c504419efacdd">fwh</a> + freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)     <span class="comment">!Freezing water</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <a class="code" href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">qm</a> = <a class="code" href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">qm</a> + qm_melt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)         <span class="comment">!Energy consumed to the melt/freezing.</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <a class="code" href="namespacesnowmod.html#a53e675abb512cd7e7ee673dd03911a54">qmrain</a> = <a class="code" href="namespacesnowmod.html#a53e675abb512cd7e7ee673dd03911a54">qmrain</a> + qm_rain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!Rain on snow</span></div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <a class="code" href="namespacesnowmod.html#a593cb8d2d82b6e80d07831e94c2013dc">qmfreez</a> = <a class="code" href="namespacesnowmod.html#a593cb8d2d82b6e80d07831e94c2013dc">qmfreez</a> + deltaqi(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + qm_freezstate<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) !Freezing water</span></div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;<span class="keywordflow">      ENDDO</span> <span class="comment">!End surface type</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160; </div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;      <span class="comment">!Update snow albedo to its maximum value if precipitation exists</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;      <span class="keywordflow">IF</span> (precip &gt; 0 .AND. sum(snowpack) &gt; 0 .AND. temp_c &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160; </div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;         <a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a> = <a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a> + precip</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160; </div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a> &gt; <a class="code" href="namespacesnowmod.html#abfd7f53c4b8f5fc53745b470eba0303d">preciplimitalb</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;            <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> = <a class="code" href="namespacesnowmod.html#a2dd094889525c7d4073c124bb54b634c">snowalbmax</a></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;            <a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a> = 0</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;         <a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a> = 0</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="suews__phys__snow_8f95_source.html#l00040">snow_cal_meltheat()</a>.</p>

</div>
</div>
<a id="a2a6602c576a01060981a378d086ec075"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a6602c576a01060981a378d086ec075">&#9670;&nbsp;</a></span>snow_cal_meltheat()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::snow_cal_meltheat </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>snowUse</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lvS_J_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lv_J_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>tstep_real</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>RadMeltFact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>TempMeltFact</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowAlbMax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowDensMin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Temp_C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Precip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>PrecipLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>PrecipLimitAlb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>nsh_real</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>Tsurf_ind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>Tsurf_ind_snow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>state_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>qn1_ind_snow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>kup_ind_snow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>SnowWater</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>deltaQi</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowPack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>snowFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowAlb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowDens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowfallCum</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>mwh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>fwh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>Qm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>QmFreez</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>QmRain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>veg_fr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>snowCalcSwitch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>Qm_melt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>Qm_freezState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>Qm_rain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>FreezMelt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>FreezState</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>FreezStateVol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>rainOnSnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>SnowDepth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>mw_ind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(ncolumnsdataoutsnow), intent(out)&#160;</td>
          <td class="paramname"><em>dataOutLineSnow</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l00040">40</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160; </div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::nsurf = 7</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::PavSurf = 1</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::BldgSurf = 2</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::WaterSurf = 7</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::ncolumnsDataOutSnow = 102 - 5</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">PARAMETER</span>::waterDens = 999.8395 <span class="comment">!Density of water in 0 cel deg</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      <span class="comment">!These are input to the module</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::snowUse</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::bldgsurf</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::nsurf</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::PavSurf</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::WaterSurf</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lvS_J_kg</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lv_J_kg</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::tstep_real</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::RadMeltFact</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::TempMeltFact</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::SnowAlbMax</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::SnowDensMin</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Temp_C</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Precip</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::PrecipLimit</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::PrecipLimitAlb</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::nsh_real</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;      <span class="comment">! REAL(KIND(1d0)),INTENT(in)::waterdens</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160; </div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::sfr</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::Tsurf_ind</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::Tsurf_ind_snow</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::state_id</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::qn1_ind_snow</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::kup_ind_snow</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::SnowWater</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::deltaQi</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160; </div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      <span class="comment">!Input and output as this is updated in this subroutine</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowPack</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::snowFrac</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::SnowAlb</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowDens</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::SnowfallCum</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160; </div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="comment">!Output:</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::mwh</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::fwh</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::Qm</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::QmFreez</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::QmRain</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::veg_fr</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::snowCalcSwitch</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160; </div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::Qm_melt</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::Qm_freezState</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::Qm_rain</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::FreezMelt</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::FreezState</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::FreezStateVol</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::rainOnSnow</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::SnowDepth</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::mw_ind</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160; </div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(ncolumnsDataOutSnow)</span>, <span class="keywordtype">INTENT(out)</span> :: dataOutLineSnow</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;      <span class="keywordflow">IF</span> (snowuse == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160; </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;         <span class="keyword">CALL </span>meltheat( &amp;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            bldgsurf, nsurf, pavsurf, watersurf, &amp;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a>, <a class="code" href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">lv_j_kg</a>, <a class="code" href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">tstep_real</a>, <a class="code" href="namespacesnowmod.html#a37a51eae2e92c0d594b8f2acbf8e2a7c">radmeltfact</a>, <a class="code" href="namespacesnowmod.html#a7243763d809e4a91d9098fbdafe567ff">tempmeltfact</a>, &amp;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <a class="code" href="namespacesnowmod.html#a2dd094889525c7d4073c124bb54b634c">snowalbmax</a>, <a class="code" href="namespacesnowmod.html#aa8834b111a576d48e70825463fae599f">snowdensmin</a>, temp_c, precip, <a class="code" href="namespacesnowmod.html#af5f7c82ab6625c3e67be5fac8829bcd2">preciplimit</a>, <a class="code" href="namespacesnowmod.html#abfd7f53c4b8f5fc53745b470eba0303d">preciplimitalb</a><span class="comment">, &amp;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment"></span>            <a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>, <a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>, sfr, tsurf_ind, state_id, qn1_ind_snow,<span class="comment"> &amp;</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment"></span>            snowwater, deltaqi, snowpack, snowfrac, <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a>, snowdens, <a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a><span class="comment">, &amp;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span>            <a class="code" href="namespacesnowmod.html#a8a86e8b1f4de8e8447c4fc264c910bd4">mwh</a>, <a class="code" href="namespacesnowmod.html#a17abf76009d5444c277c504419efacdd">fwh</a>, <a class="code" href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">qm</a>, <a class="code" href="namespacesnowmod.html#a593cb8d2d82b6e80d07831e94c2013dc">qmfreez</a>, <a class="code" href="namespacesnowmod.html#a53e675abb512cd7e7ee673dd03911a54">qmrain</a>, snowcalcswitch, &amp;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            qm_melt, qm_freezstate, qm_rain, freezmelt, freezstate, freezstatevol<span class="comment">, &amp;</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment"></span>            rainonsnow, snowdepth, mw_ind)</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160; </div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;         <span class="keyword">CALL </span>veg_fr_snow( &amp;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            sfr, snowfrac, nsurf, &amp;<span class="comment">!input</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            veg_fr)<span class="comment">!output</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160; </div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;      <span class="keywordflow">ELSE</span> <span class="comment">! no snow calculation</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;         <a class="code" href="namespacesnowmod.html#a8a86e8b1f4de8e8447c4fc264c910bd4">mwh</a> = 0</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;         <a class="code" href="namespacesnowmod.html#a17abf76009d5444c277c504419efacdd">fwh</a> = 0</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;         <a class="code" href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">qm</a> = 0</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;         <a class="code" href="namespacesnowmod.html#a593cb8d2d82b6e80d07831e94c2013dc">qmfreez</a> = 0</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;         <a class="code" href="namespacesnowmod.html#a53e675abb512cd7e7ee673dd03911a54">qmrain</a> = 0</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;         <a class="code" href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowfallcum</a> = 0</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;         snowcalcswitch = 0</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;         qm_melt = 0</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;         qm_freezstate = 0</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;         qm_rain = 0</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;         freezmelt = 0</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;         freezstate = 0</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;         freezstatevol = 0</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;         rainonsnow = 0</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;         snowdepth = 0</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;         mw_ind = 0</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160; </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;         <span class="comment">! update veg_fr when snowFrac=0</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;         snowfrac = 0</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;         <span class="keyword">CALL </span>veg_fr_snow( &amp;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            sfr, snowfrac, nsurf, &amp;<span class="comment">!input</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            veg_fr)<span class="comment">!output</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160; </div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="keywordflow">      END IF</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;      <span class="comment">! pack output into one line</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;      dataoutlinesnow = [ &amp;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                        snowpack(1:nsurf), mw_ind(1:nsurf), qm_melt(1:nsurf<span class="comment">), &amp; !26</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                        qm_rain(1:nsurf), qm_freezstate(1:nsurf), snowfrac<span class="comment">(1:(nsurf - 1)), &amp; !46</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        rainonsnow(1:nsurf), &amp; <span class="comment">!53</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        qn1_ind_snow(1:nsurf), kup_ind_snow(1:nsurf), freezmelt<span class="comment">(1:nsurf), &amp; !74</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                        snowwater(1:nsurf), snowdens(1:nsurf), &amp; <span class="comment">!88</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        snowdepth(1:nsurf), tsurf_ind_snow(1:nsurf)]</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;      <span class="comment">! dataOutLineSnow=set_nan(dataOutLineSnow)</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="suews__phys__snow_8f95_source.html#l00207">meltheat()</a>, and <a class="el" href="suews__phys__snow_8f95_source.html#l01272">veg_fr_snow()</a>.</p>

<p class="reference">Referenced by <a class="el" href="suews__ctrl__driver_8f95_source.html#l00073">suews_driver::suews_cal_main()</a>.</p>

</div>
</div>
<a id="a984d66c788d944a28a5964badb0b1df1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a984d66c788d944a28a5964badb0b1df1">&#9670;&nbsp;</a></span>snowcalc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::snowcalc </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>tstep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>imin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>it</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>dectime</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>EvapMethod</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>CRWmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>CRWmax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>nsh_real</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lvS_J_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>lv_j_kg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>avdens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>avRh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Press_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Temp_C</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>RAsnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>psyc_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>avcp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>sIce_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>PervFraction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>vegfraction</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>addimpervious</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>vpd_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>qn_e</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>s_hPa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>ResistSurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>RA</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>rb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>tlv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>snowdensmin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(0:23, 2), intent(in)&#160;</td>
          <td class="paramname"><em>SnowProf_24hr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>precip</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>PipeCapacity</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>RunoffToWater</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>addVeg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowLimPaved</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowLimBldg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>FlowChange</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>drain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>WetThresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>stateOld</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>mw_ind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>SoilStoreCap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>rainonsnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>freezmelt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>freezstate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>freezstatevol</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>Qm_Melt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>Qm_rain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>Tsurf_ind</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, dimension(3), intent(in)&#160;</td>
          <td class="paramname"><em>dayofWeek_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(6, nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>StoreDrainPrm</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>SnowPackLimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>AddWater</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>addwaterrunoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>soilstore_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowPack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(2), intent(inout)&#160;</td>
          <td class="paramname"><em>SurplusEvap</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>snowFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowWater</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>iceFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowDens</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>runoffAGimpervious</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>runoffAGveg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>surplusWaterBody</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>rss_nsurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>runoffSnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>runoff</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>runoffSoil</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>chang</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>changSnow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>SnowToSurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>state_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>ev_snow</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>SnowDepth</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(2), intent(out)&#160;</td>
          <td class="paramname"><em>SnowRemoval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>swe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>ev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>chSnow_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>ev_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>qe_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>runoff_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>surf_chang_tot</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>runoffPipes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>mwstore</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>runoffwaterbody</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l00469">469</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <span class="comment">!Calculation of snow and water balance on 5 min timestep. Treats snowfree and snow covered</span></div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;      <span class="comment">!areas separately. Weighting is taken into account in the overall values.</span></div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;      <span class="comment">!Last modified:</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <span class="comment">!  LJ in 6 May 2015 - Modified to run with timestep</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="comment">!  HCW 06 Mar 2015 - Unused variable &#39;i&#39; removed.</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      <span class="comment">!  HCW 26 Jan 2015 - Added weekday/weekend option for snow clearing profiles</span></div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <span class="comment">!  LJ in 24 May 2013</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      <span class="comment">!========================================================================</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespacewaterdist__module.html">waterdist_module</a>, <span class="keywordtype">ONLY</span>: <a class="code" href="namespacewaterdist__module.html#aef680604133834b26fdf6b25bfc6bcf0">updateflood</a></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160; </div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::nsurf = 7<span class="comment">! number of surface types</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::PavSurf = 1  <span class="comment">!New surface classes: Grass = 5th/7 surfaces</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::BldgSurf = 2  <span class="comment">!New surface classes: Grass = 5th/7 surfaces</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::ConifSurf = 3  <span class="comment">!New surface classes: Grass = 5th/7 surfaces</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;      <span class="comment">! INTEGER,PARAMETER::DecidSurf = 4  !New surface classes: Grass = 5th/7 surfaces</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <span class="comment">! INTEGER,PARAMETER::GrassSurf = 5</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::BSoilSurf = 6<span class="comment">!New surface classes: Grass = 5th/7 surfaces</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::WaterSurf = 7</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160; </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">PARAMETER</span>::snowfractionchoice = 2 <span class="comment">! this PARAMETER is used all through the model</span></div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">PARAMETER</span>::waterDens = 999.8395 <span class="comment">!Density of water in 0 cel deg</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::id</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::nsurf</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::tstep</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::imin</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::it</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::is</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160; </div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::ConifSurf</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::BSoilSurf</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::BldgSurf</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::PavSurf</span></div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;      <span class="comment">! INTEGER,INTENT(in)::WaterSurf</span></div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::EvapMethod<span class="comment">!Evaporation calculated according to Rutter (1) or Shuttleworth (2)</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">DIMENSION(3)</span>, <span class="keywordtype">INTENT(in)</span>  ::DayofWeek_id</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::dectime</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::CRWmin</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::CRWmax</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::nsh_real</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lvS_J_kg</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::lv_j_kg</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::avdens</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::vpd_hPa <span class="comment">! vapour pressure deficit [hPa]</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::qn_e <span class="comment">!net available energy for evaporation</span></div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::avRh</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Press_hPa</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::Temp_C</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::RAsnow</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::psyc_hPa</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::avcp</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::sIce_hPa</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::PervFraction</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::vegfraction</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::addimpervious</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;      <span class="comment">! REAL(KIND(1d0)),INTENT(in)::numPM</span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::s_hPa</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::ResistSurf</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;      <span class="comment">! REAL(KIND(1d0)),INTENT(in)::sp</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::RA</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::rb</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::tlv</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::snowdensmin</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::precip</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::PipeCapacity</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::RunoffToWater</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::addVeg</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::SnowLimPaved</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::SnowLimBldg</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>::FlowChange</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::drain</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::WetThresh</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::stateOld</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::mw_ind</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::SoilStoreCap</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::rainonsnow</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::freezmelt</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::freezstate</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::freezstatevol</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::Qm_Melt</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::Qm_rain</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::Tsurf_ind</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::sfr</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::SnowPackLimit</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::AddWater</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::addwaterrunoff</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(6, nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::StoreDrainPrm</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(0:23, 2)</span>, <span class="keywordtype">INTENT(in)</span>::SnowProf_24hr</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160; </div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;      <span class="comment">!Updated status: input and output</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::runoffAGveg</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::runoffAGimpervious</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::surplusWaterBody</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::soilstore_id</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowPack</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::snowFrac</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowWater</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::iceFrac</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowDens</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(2)</span>, <span class="keywordtype">INTENT(inout)</span>:: SurplusEvap</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160; </div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::rss_nsurf</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::runoffSnow <span class="comment">!Initialize for runoff caused by snowmelting</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::runoff</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::runoffSoil</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::chang</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::changSnow</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::SnowToSurf</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::state_id</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::SnowDepth</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>::ev_snow</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(2)</span>, <span class="keywordtype">INTENT(out)</span>::SnowRemoval</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160; </div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::swe</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::ev</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::ev_tot</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::chSnow_tot</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::qe_tot</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::runoff_tot</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::surf_chang_tot</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::runoffPipes</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::mwstore</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span>::runoffwaterbody</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160; </div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::qe</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;      <span class="comment">! REAL(KIND(1d0))::Evap_SUEWS_Snow</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::MeltExcess      <span class="comment">!Excess melt water that needs to leave SnowPack</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::snowTotInit</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::EvPart</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::runoffTest</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::snowFracFresh1   <span class="comment">!Snow fraction for newly formed SnowPack</span></div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::snowFracFresh2   <span class="comment">!Snow fraction for newly formed SnowPack from state_id only</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::snowFracOld</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::WaterHoldCapFrac</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::FWC                <span class="comment">!Water holding capacity of snow in mm</span></div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::tlv_sub</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;      <span class="comment">! REAL(KIND(1d0)):: SnowDepletionCurve</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160; </div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;      <span class="keywordtype">INTEGER</span>:: iu                        <span class="comment">!1=weekday OR 2=weekend</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">PARAMETER</span> :: IPThreshold_mmhr = 10   <span class="comment">!Threshold for intense precipitation [mm hr-1]</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160; </div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(7)</span>::capStore <span class="comment">! current storage capacity [mm]</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160; </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;      <span class="comment">!========================================================================</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;      <span class="comment">!Initialize variables for the calculation of water storages and evaporation</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;      ev_tot = 0</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;      qe_tot = 0</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;      runoff_tot = 0</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;      surf_chang_tot = 0</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160; </div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;      <span class="comment">!swe = 0</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;      chsnow_tot = 0</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      <span class="comment">!runoffPipes = 0</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;      <span class="comment">!mwstore = 0</span></div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;      <span class="comment">!runoffwaterbody = 0</span></div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;      rss_nsurf = 0</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;      <span class="comment">!state_id = 0</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;      snowdepth = 0</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;      ev_snow = 0</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;      <span class="comment">!SnowRemoval = 0</span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;      <a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a> = 0</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160; </div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;      <span class="comment">! Use weekday or weekend snow clearing profile</span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;      iu = 1     <span class="comment">!Set to 1=weekday</span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;      <span class="keywordflow">IF</span> (dayofweek_id(1) == 1 .OR. dayofweek_id(1) == 7) iu = 2  <span class="comment">!Set to 2=weekend</span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;      <span class="comment">!write(*,*) is</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;      runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0 <span class="comment">!Initialize for runoff caused by snowmelting</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;      runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;      runoffsoil(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;      chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;      changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;      runofftest = 0</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;      snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;      evpart = 0</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;      <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> = 0</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;      snowfracfresh1 = 0</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;      snowfracfresh2 = 0</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;      snowfracold = 0</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;      <span class="comment">!Initial SnowPack + meltwater in it</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;      snowtotinit = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160; </div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;      <span class="comment">!Calculate water holding capacity (Jin et al. 1999)</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;      <span class="keywordflow">IF</span> (snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt;= 200) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;         <a class="code" href="namespacesnowmod.html#a7eb3b7cf48a254f8a7b89dfcfcf5288d">waterholdcapfrac</a> = <a class="code" href="namespacesnowmod.html#afadc17fdadab7b30932ccc52f50b99df">crwmin</a></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;         <a class="code" href="namespacesnowmod.html#a7eb3b7cf48a254f8a7b89dfcfcf5288d">waterholdcapfrac</a> = <a class="code" href="namespacesnowmod.html#afadc17fdadab7b30932ccc52f50b99df">crwmin</a> + (<a class="code" href="namespacesnowmod.html#a44d95596182bac1d393bd6e9a30c5f09">crwmax</a> - <a class="code" href="namespacesnowmod.html#afadc17fdadab7b30932ccc52f50b99df">crwmin</a>)*(200 - snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">))/200</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;<span class="comment"></span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;      <span class="comment">!======================================================================</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;      <span class="comment">! Calculate evaporation from SnowPack and snow free surfaces (in mm)</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;      <span class="comment">! IF (snowFrac(is)&lt;1) CALL Evap_SUEWS !ev and qe for snow free surface out</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;      capstore(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = storedrainprm(6, <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;      <span class="keywordflow">IF</span> (snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 1) <span class="keyword">CALL </span><a class="code" href="suews__phys__evap_8f95.html#a1139f9ab66d71bf517d0e6abc01288c3">evap_suews</a>( &amp;</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;         evapmethod, state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), wetthresh(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), capstore(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), &amp;<span class="comment">!input</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;         <a class="code" href="namespacemoist.html#a907186a43d25a5ed890b202141c1400a">vpd_hpa</a>, avdens, <a class="code" href="namespacemoist.html#a0b90f7e6761869efa414063f6ef84f6f">avcp</a>, qn_e, <a class="code" href="namespacemoist.html#a06b3a1e3aa06034efaad2df61b59f28d">s_hpa</a>, <a class="code" href="namespacemoist.html#a5a7cfba4c3c7fd580026b89d923b61df">psyc_hpa</a>, <a class="code" href="namespacesues__data.html#a27b202e2bf05cfd178642f06120fda94">resistsurf</a>, <a class="code" href="namespacesues__data.html#a12712df2a3ef0b83f2e599caf2b9a751">ra</a>, <a class="code" href="namespacesues__data.html#a4a6bc9911d35670ae9e4867ea2476fc4">rb</a><span class="comment">, <a class="code" href="namespacemoist.html#ab532226ee34f5b2568b9974a694da3a6">tlv</a>, &amp;</span></div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;<span class="comment"></span>         rss_nsurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>, qe) <span class="comment">!output</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160; </div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;      <span class="keywordflow">IF</span> (snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;         <span class="keyword">call </span>evap_suews_snow(qm_melt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), qm_rain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), <a class="code" href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">lvs_j_kg</a>, avdens<span class="comment">, avrh, press_hpa, temp_c, <a class="code" href="namespacesues__data.html#abe3d3d6bafc04802fe09ca8fd7a5ebb6">rasnow</a>, &amp;</span></div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="comment"></span>                              <a class="code" href="namespacemoist.html#a5a7cfba4c3c7fd580026b89d923b61df">psyc_hpa</a>, <a class="code" href="namespacesues__data.html#ac6af955be55f5fe026b4ba1ab6ec480e">tstep</a>, <a class="code" href="namespacemoist.html#a0b90f7e6761869efa414063f6ef84f6f">avcp</a>, <a class="code" href="namespacemoist.html#af9212d0e505f0524f70140ff2108f745">sice_hpa</a>, <a class="code" href="namespacetime.html#acf0bd1b102769fcbe36a171b4b9e2a25">dectime</a>, ev_snow<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), <a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a>)</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;<span class="comment"></span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160; </div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;      <span class="comment">!If not enough water for evaporation in impervious surfaces,</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;      <span class="comment">!evaporation is taken from pervious surfaces</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> &gt; 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;         <span class="keywordflow">IF</span> (pervfraction /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            evpart = (<a class="code" href="namespacesues__data.html#a08d117cca68ee0e84a8b286a038434c6">surplusevap</a>(pavsurf)*sfr(pavsurf) + <a class="code" href="namespacesues__data.html#a08d117cca68ee0e84a8b286a038434c6">surplusevap</a>(bldgsurf<span class="comment">)*sfr(bldgsurf))/pervfraction</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;<span class="comment"></span><span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;      <span class="comment">!============================================================================</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;      <span class="comment">!Water surface is treated separately</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == watersurf .AND. sfr(watersurf) &gt; 0) <span class="keywordflow">GO TO</span> 606</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;      <span class="comment">!The calculations are divided into 2 main parts</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;      <span class="comment">! 1) Surface is fully covered with snow at the beginning of the time step</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;      <span class="comment">! 2) Surface is not fully covered with snow but rather part is snow free OR</span></div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;      <span class="comment">!    surface not orginally covered with snow, but the snow forms at the current timestep</span></div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160; </div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;      <span class="comment">!1)------------------------------------------------------------------</span></div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;      <span class="comment">!  ------------------------------------------------------------------</span></div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;      <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0 .AND. snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160; </div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;         ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + evpart <span class="comment">!Evaporation surplus</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160; </div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;         <span class="comment">!(Snowfall per interval+freezing of melt water and surface state_id) - (meltwater+evaporation from SnowPack)</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;         changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = (precip + freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) - (mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + ev_snow<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) !Calculate change in SnowPack (in mm)</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160; </div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;         <span class="comment">!If rain on snow event, add this water to SnowWater</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;         <span class="keywordflow">IF</span> (rainonsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;            changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - precip</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + rainonsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160; </div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;         snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)  <span class="comment">!Update SnowPack</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;         <span class="comment">!---------If SnowPack exists after the state_id calculations</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;         <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160; </div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="comment">!Add melted water to meltstore and freeze water according to freezMelt(is)</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;            snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160; </div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <span class="comment">!Calculate water holding capacity (FWC: Valeo and Ho, 2004) of the SnowPack</span></div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;            fwc = <a class="code" href="namespacesnowmod.html#a7eb3b7cf48a254f8a7b89dfcfcf5288d">waterholdcapfrac</a>*snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160; </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="comment">!If FWC is exceeded, excess meltwater (MeltExcess) will leave from the SnowPack</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            <span class="keywordflow">IF</span> (snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt;= fwc) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;               meltexcess = 0                      <span class="comment">!Initialize the excess meltwater</span></div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;               meltexcess = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - fwc <span class="comment">!Calculate the exceess water</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = fwc            <span class="comment">!Update the SnowWater to the maximum it can hold</span></div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;               runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + meltexcess</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160; </div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            <span class="comment">!At the end of the hour calculate possible snow removal</span></div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#a0b95abe25d6e77ca8f4b3ba05c3176fa">snowprof_24hr</a>(<a class="code" href="namespacetime.html#a88a6c141593462330d65da0397b9b71d">it</a>, iu) == 1 .AND. <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> &lt; 3 .AND. (<a class="code" href="namespacetime.html#a9be08cae4e706325fe3524f4370754cc">imin</a> == (<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a><span class="comment"> - 1)/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>*60)) &amp;</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;<span class="comment"></span>               <span class="keyword">CALL </span>snowrem( &amp;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;               <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>, pavsurf, bldgsurf, nsurf, &amp;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;               snowfrac, sfr, &amp;</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;               snowpack, <a class="code" href="namespacesnowmod.html#a9c7d574d109596d16542b38123065e66">snowremoval</a>, &amp;</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;               <a class="code" href="namespacesnowmod.html#a23247e3b94ab1e3b9076144680243d62">snowlimpaved</a>, <a class="code" href="namespacesnowmod.html#aa93dd6da6254734639979ed6869b519a">snowlimbldg</a>)</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="comment">!----------If SnowPack is negative, it melts at this timestep</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;         <span class="keywordflow">ELSEIF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            <span class="comment">!If freezing meltwater inside this timestep, remove it from the SnowWater</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) +<span class="comment"> snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;<span class="comment"></span>            snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0.0   <span class="comment">!Set the snow pack and snow</span></div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            snowfracold = 1</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;            snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160; </div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <span class="keywordflow">IF</span> (snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span> <span class="comment">!Not enough water in the meltwater store,</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;               ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!QUESTION: evaporation from snow is decreased?</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;               <span class="keywordflow">IF</span> (ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;               changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;               chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)  <span class="comment">!Meltwater goes to surface state_id as no snow exists anymore</span></div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;               state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;<span class="keywordflow">         ENDIF</span> <span class="comment">!SnowPack negative or positive</span></div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;         <span class="comment">!2)------Surface not fully covered with snow-------------------------------------------</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;         <span class="comment">!  ------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;      <span class="keywordflow">ELSEIF</span> (snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 1) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160; </div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;         <span class="comment">!Snow calculations: SnowPack can either exist or form at the current timestep</span></div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;         <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + evpart <span class="comment">!Evaporation surplus</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160; </div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="comment">!----SnowPack water balance for the whole surface area. In reality snow depth = SnowPack/snowFrac(is)</span></div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="comment">!(Snowfall per interval+freezing of melt water and surface state_id) - (meltwater+evaporation from SnowPack)</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;            changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = (precip + freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))<span class="comment"> - (mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) !Calculate change in SnowPack (in mm)</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160; </div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="comment">!If rain on snow event, add this water to SnowWater</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;            <span class="keywordflow">IF</span> (rainonsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;               changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - precip</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + rainonsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160; </div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="comment">!The fraction of snow will update when:</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            <span class="comment">!a) Surface state_id is dry but precipitation occurs =1</span></div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;            <span class="comment">!b) There is both precipitation and all surface state_id freezes =1</span></div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            <span class="comment">!c) No precipitation but all state_id freezes at a single timestep =2</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            <span class="comment">!d) Part of the surface freezes</span></div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">IF</span> (precip &gt; 0 .AND. freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) <span class="keywordflow">THEN</span> <span class="comment">!both a) and b)</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;               snowfracfresh1 = 1</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;            <span class="keywordflow">ELSEIF</span> (precip == 0 .AND. freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0 .AND. freezstate<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) </span><span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;               snowfracfresh1 = 1</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;               <span class="comment">!snowFracFresh1=SnowDepletionCurve(is,SnowPack(is),SnowPackLimit(is))</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;               <span class="comment">!if (snowFracFresh1&lt;0.001) snowFracFresh1=0.001</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="keywordflow">ELSEIF</span> (freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0 .AND. freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">)) </span><span class="keywordflow">THEN</span><span class="comment"> !This if not all water freezes</span></div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;               snowfracfresh1 = 0.95 <span class="comment">!Now this fraction set to something close to one. Should be improved in the future at some point</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;               <span class="comment">!if (is==1)then</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;               <span class="comment">! write(*,*) id,it,imin,snowfrac(is),FreezState(is),state_id(is)</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;               <span class="comment">! pause</span></div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;               <span class="comment">!endif</span></div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160; </div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="comment">!SnowPack can also form at the current timestep (2). If this forms purely from snowfall or/and all water at surface freezes,</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <span class="comment">!the whole surface will be covered with snow. If there is water on ground this snowfall can immediately melt</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;            <span class="comment">!and in this case the snow fraction is not necessarily 1 but its information is saved to snowFracFresh that</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;            <span class="comment">!is taken into account in snow fraction after calculation of state_id.</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;         <span class="keywordflow">ELSEIF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == 0 .AND. tsurf_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160; </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="comment">!The fraction of snow will get a value of 1 (ie full snow cover):</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="comment">!Surface state_id is dry but precipitation occurs, no precipitation but all state_id freezes at a single timestep,</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;            <span class="comment">!There is both precipitation and all surface state_id freezes</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="keywordflow">IF</span> ((precip &gt; 0 .AND. state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == 0) .OR. (precip == 0 .AND.<span class="comment"> freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) .OR. &amp;</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;<span class="comment"></span>                (precip &gt; 0 .AND. freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160; </div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;               <span class="comment">!ev=ev+EvPart</span></div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;               changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = precip + freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;               snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)  <span class="comment">!Update SnowPack</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;               snowfracfresh1 = 1</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;               icefrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/(freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + precip)</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;               snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#aa8834b111a576d48e70825463fae599f">snowdensmin</a></div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160; </div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            <span class="keywordflow">IF</span> (freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0 .AND. freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160; </div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;               changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = precip + freezstatevol(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;               snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)  <span class="comment">!Update SnowPack</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;               snowfracfresh2 = 0.95 <span class="comment">!Now this fraction set to something close to one. Should be improved in the future at some point</span></div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160; </div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;               <span class="comment">!snowFracFresh2=SnowDepletionCurve(is,SnowPack(is),SnowPackLimit(is))</span></div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;               <span class="comment">!if (snowFracFresh2&lt;0.001) snowFracFresh2=0.001</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;               icefrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 1</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;               snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#aa8834b111a576d48e70825463fae599f">snowdensmin</a></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;               <span class="comment">!write(*,*) 2,is,id,it,imin,snowfrac(is),FreezState(is),state_id(is),state_id(is)+Precip</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;               <span class="comment">!pause</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160; </div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160; </div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;         <span class="comment">!---------If SnowPack exists after the state_id calculations</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;         <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160; </div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="comment">!Add melted water to meltstore and freeze water according to freezMelt(is)</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160; </div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="comment">!Calculate water holding capacity (FWC: Valeo and Ho, 2004) of the SnowPack</span></div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            fwc = <a class="code" href="namespacesnowmod.html#a7eb3b7cf48a254f8a7b89dfcfcf5288d">waterholdcapfrac</a>*snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;            <span class="comment">!If FWC is exceeded, excess meltwater (MeltExcess) will leave from the SnowPack</span></div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            <span class="keywordflow">IF</span> (snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt;= fwc) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;               meltexcess = 0                      <span class="comment">!Initialize the excess meltwater</span></div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;               meltexcess = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - fwc <span class="comment">!Calculate the exceess water</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = fwc            <span class="comment">!Update the SnowWater to the maximum it can hold</span></div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160; </div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;               <span class="comment">!If the fraction of snow is greater than 0.8 or if the surface is is buildings,</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;               <span class="comment">!the excess water will directly go to runoff. Otherwise it will flow to the</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;               <span class="comment">!snow free area via SnowToSurf(is)</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;               <span class="keywordflow">IF</span> ((snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0.9 .AND. <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> /= bldgsurf) .OR. (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> ==<span class="comment"> bldgsurf)) </span><span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;                  runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + meltexcess</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;               <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;                  snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + meltexcess*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">)/(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;<span class="comment"></span><span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="comment">!At the end of the hour calculate possible snow removal</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#a0b95abe25d6e77ca8f4b3ba05c3176fa">snowprof_24hr</a>(<a class="code" href="namespacetime.html#a88a6c141593462330d65da0397b9b71d">it</a>, iu) == 1 .AND. <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> &lt; 3 .AND. (<a class="code" href="namespacetime.html#a9be08cae4e706325fe3524f4370754cc">imin</a> == (<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a><span class="comment"> - 1)/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>*60)) &amp;</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="comment"></span>               <span class="keyword">CALL </span>snowrem( &amp;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;               <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>, pavsurf, bldgsurf, nsurf, &amp;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;               snowfrac, sfr, &amp;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;               snowpack, <a class="code" href="namespacesnowmod.html#a9c7d574d109596d16542b38123065e66">snowremoval</a>, &amp;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;               <a class="code" href="namespacesnowmod.html#a23247e3b94ab1e3b9076144680243d62">snowlimpaved</a>, <a class="code" href="namespacesnowmod.html#aa93dd6da6254734639979ed6869b519a">snowlimbldg</a>)</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160; </div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;            <span class="comment">!----------If SnowPack is negative, it melts at this timestep</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;         <span class="keywordflow">ELSEIF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160; </div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;            <span class="comment">!If freezing meltwater inside this timestep, remove it from the SnowWater</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;            snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - freezmelt(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) +<span class="comment"> snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;            snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0.0   <span class="comment">!Set the snow pack and snow</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;            snowfracfresh1 = 0</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            snowfracfresh2 = 0</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;            snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160; </div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            <span class="keywordflow">IF</span> (snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span> <span class="comment">!Not enough water in the meltwater store,</span></div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;               ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!QUESTION: evaporation from snow is decreased.?</span></div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;               <span class="keywordflow">IF</span> (ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;               changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = changsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;               snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">)/(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;<span class="comment"></span>               snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;<span class="keywordflow">         ENDIF</span> <span class="comment">!SnowPack negative or positive</span></div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160; </div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;         <span class="comment">!--------</span></div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;         <span class="comment">!Next the snow free surface (3). Calculations only done if snowfraction is smaller than 1</span></div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;         <span class="keywordflow">IF</span> ((<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == pavsurf .OR. <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == bldgsurf) .AND. snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 1)<span class="comment"> </span><span class="keywordflow">THEN</span><span class="comment">  !Impervious surfaces (paved, buildings)</span></div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; </div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;            <span class="comment">!Surface store update. If precipitation is greater than the threshold, the exceeding water</span></div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;            <span class="comment">!goes directly to runoff</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="keywordflow">IF</span> (precip &gt; ipthreshold_mmhr/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;               <span class="comment">!runoff = runoff + (precipitation+water from the snow surface+water from other surfaces-the thereshold limit)</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;               runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + (precip + snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + addwater<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - ipthreshold_mmhr/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>)</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;<span class="comment"></span>               chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = ipthreshold_mmhr/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a> - (drain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> +<span class="comment"> freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;<span class="comment"></span>            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;               <span class="comment">!Add precip and water from other surfaces and remove drainage, evap and freezing of state_id</span></div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;               chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = precip + snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + addwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - (drain<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> + freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="comment"></span><span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160; </div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;            state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!Change in state_id (for whole surface area areasfr(is))</span></div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160; </div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            <span class="comment">!Add water from impervious grids</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;            <span class="comment">! Check sfr/=0 added HCW 08 Dec 2015</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == pavsurf .AND. sfr(pavsurf) &gt; 0) state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = state_id<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + (<a class="code" href="namespacesues__data.html#a98c579aa36901f7c40f5a7736337bb21">addimpervious</a>)/sfr(pavsurf)</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + drain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*addwaterrunoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!Drainage (not flowing to other surfaces) goes to runoff</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160; </div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            <span class="keywordflow">IF</span> (state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0.0) <span class="keywordflow">THEN</span>  <span class="comment">!Surface state_id cannot be negative</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;               <a class="code" href="namespacesues__data.html#a08d117cca68ee0e84a8b286a038434c6">surplusevap</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = abs(state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) <span class="comment">!take evaporation from other surfaces in mm</span></div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;               <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> = <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> - <a class="code" href="namespacesues__data.html#a08d117cca68ee0e84a8b286a038434c6">surplusevap</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;               state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0.0</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160; </div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;         <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> &gt;= 3 .AND. snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 1) <span class="keywordflow">THEN</span> <span class="comment">! Pervious surfaces (conif, decid, grass unirr, grass irr)</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;            <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> = <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> + evpart</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            <span class="comment">!Change in water stores</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            <span class="keywordflow">IF</span> (vegfraction &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;               <span class="keywordflow">IF</span> (precip + <a class="code" href="namespacesues__data.html#a326ca0cd80d6cd1bdc0cb49352972724">addveg</a>*(sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/vegfraction) &gt; (ipthreshold_mmhr<span class="comment">/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>)) </span><span class="keywordflow">THEN</span><span class="comment"> !if 5min precipitation is larger than 10 mm</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                  runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + (precip + <a class="code" href="namespacesues__data.html#a326ca0cd80d6cd1bdc0cb49352972724">addveg</a>*(sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/vegfraction<span class="comment">) + &amp;</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;<span class="comment"></span>                                             snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + addwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">) - (ipthreshold_mmhr/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>))</span></div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;<span class="comment"></span>                  chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = (ipthreshold_mmhr/<a class="code" href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">nsh_real</a>) - (drain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) +<span class="comment"> <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> + freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"></span>               <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                  chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = precip + <a class="code" href="namespacesues__data.html#a326ca0cd80d6cd1bdc0cb49352972724">addveg</a>*(sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)/vegfraction) + snowtosurf<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + &amp;</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment"></span>                              addwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - (drain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> + freezstate<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment"></span><span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;               chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = precip + snowtosurf(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + addwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - (drain<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> + freezstate(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;<span class="comment"></span><span class="keywordflow">            END IF</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160; </div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160; </div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;            <span class="comment">!Add water in soil store only if ground is not frozen</span></div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;            <span class="keywordflow">IF</span> (temp_c &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;               soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + drain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*addwaterrunoff<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment"></span>            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;               runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + drain(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*addwaterrunoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160; </div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;            <span class="comment">!If state_id of the surface is negative, remove water from soilstore</span></div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;            <span class="keywordflow">IF</span> (state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0.0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160; </div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;               <span class="keywordflow">IF</span> ((soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) &gt;= 0 .AND. temp_c &gt;<span class="comment"> 0) </span><span class="keywordflow">THEN</span><span class="comment"> !If water in soilstore, water is removed</span></div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160; </div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                  soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 <span class="comment">- snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment"></span>                  state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0.0</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;               <span class="keywordflow">ELSE</span> <span class="comment">!If not water in the soilstore evaporation does not occur</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                  chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = chang(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;                  <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> = <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a> + state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                  state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0.0</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;<span class="keywordflow">               ENDIF</span></div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;<span class="keywordflow">            ENDIF</span> <span class="comment">!state_id is negative</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160; </div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="comment">!If soilstorage is full at this point, excess will go to surface runoff</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="keywordflow">IF</span> (soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; soilstorecap(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;               runofftest = runofftest + (soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - soilstorecap<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;<span class="comment"></span>               soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = soilstorecap(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;            <span class="keywordflow">ELSEIF</span> (soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;               soilstore_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160; </div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="keywordflow">         ENDIF</span> <span class="comment">!Surface type</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160; </div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="keywordflow">      ENDIF</span> <span class="comment">!Surface fraction</span></div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160; </div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;      <span class="comment">!-------------------------------------------------------------------------------------------------------------------</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;      <span class="comment">!Calculate change in SnowPack and state_id for the respective surface areas</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;      <span class="comment">!Here the case where not all surface state_id freezes is handled</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      <span class="keywordflow">IF</span> (snowfracfresh2 &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;         surf_chang_tot = (state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - stateold(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) - precip*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfracfresh2)</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment"></span>         chsnow_tot = ((snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) - snowtotinit)*sfr<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) - precip*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfracfresh2</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment"></span>      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;         surf_chang_tot = (state_id(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - stateold(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;<span class="comment"></span>         chsnow_tot = ((snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) - snowtotinit)*sfr<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold)</span></div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;<span class="comment"></span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160; </div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;      <span class="comment">!Add evaporation to total</span></div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == bldgsurf .OR. <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == pavsurf) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;         ev_tot = <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) + ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max<span class="comment">(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold)</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;<span class="comment"></span>         qe_tot = ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*<a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a>*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>*<a class="code" href="namespacemoist.html#ab532226ee34f5b2568b9974a694da3a6">tlv</a>*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;<span class="comment"></span>      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;         ev_tot = <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) + ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max<span class="comment">(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold)</span></div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;<span class="comment"></span>         qe_tot = ev_snow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*<a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a>*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold<span class="comment">) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>*<a class="code" href="namespacemoist.html#ab532226ee34f5b2568b9974a694da3a6">tlv</a>*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;<span class="comment"></span><span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;      <span class="comment">!========RUNOFF=======================</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      <span class="comment">!Add runoff to pipes</span></div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;      <a class="code" href="namespacesues__data.html#af52acc52e5d46d875f504d1788e8e548">runoffpipes</a> = <a class="code" href="namespacesues__data.html#af52acc52e5d46d875f504d1788e8e548">runoffpipes</a> + runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a><span class="comment">), snowfracold) + runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) &amp;</span></div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;<span class="comment"></span>                    + runofftest*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;      <span class="keyword">CALL </span><a class="code" href="namespacewaterdist__module.html#aef680604133834b26fdf6b25bfc6bcf0">updateflood</a>( &amp;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;         <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>, runoff, &amp;<span class="comment">! input:</span></div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;         sfr, <a class="code" href="namespacesues__data.html#a98b7fc0f23539e7f56ea37af0daa8ea4">pipecapacity</a>, <a class="code" href="namespacesues__data.html#a40beadb93fc947febdfd1c8fcc633a3d">runofftowater</a>, &amp;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;         <a class="code" href="namespacesues__data.html#a32d5aa6f8ce1907e4a4cfea8cd7e1119">runoffagimpervious</a>, <a class="code" href="namespacesues__data.html#a1e694c72624ccedb43be069e4764237d">surpluswaterbody</a>, <a class="code" href="namespacesues__data.html#aeafc4cc2008ab8f39387e34d938422ff">runoffagveg</a>, <a class="code" href="namespacesues__data.html#af52acc52e5d46d875f504d1788e8e548">runoffpipes</a>)<span class="comment">! inout:</span></div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160; </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;      runoff_tot = runoffsnow(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold)<span class="comment"> + runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*(1 - snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)) &amp;</span></div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;<span class="comment"></span>                   + runofftest*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160; </div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;      <span class="comment">!===Update snow depth, weighted SWE, and Mwstore</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;      <span class="keywordflow">IF</span> (snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) /= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;         snowdepth(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*<a class="code" href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">waterdens</a>/snowdens(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160; </div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;      <span class="comment">! Calculate overall snow water equivalent</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a> = <a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a> + snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold)</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <a class="code" href="namespacesnowmod.html#abb6cc208c99b46f7941fe721aa6c1d7c">mwstore</a> = <a class="code" href="namespacesnowmod.html#abb6cc208c99b46f7941fe721aa6c1d7c">mwstore</a> + snowwater(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*sfr(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>)*max(snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowfracold<span class="comment">)</span></div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;      <span class="comment">!if (id==6.and.it==13.and.imin==20) then!</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;      <span class="comment">!if (id==85.and.it==3.and.imin==10) then!</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;      <span class="comment">! if (id==92.and.it==21.and.imin==35) then!</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;      <span class="comment">!  write(*,*)  ((SnowPack(is)+SnowWater(is))-snowTotInit)*sfr(is)*(1-snowFrac(is)),&amp;</span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;      <span class="comment">!              runoff(is)*sfr(is)*(1-snowFrac(is)),&amp;</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;      <span class="comment">!              ev*sfr(is)*(1-snowFrac(is)),&amp;</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      <span class="comment">!              (state_id(is)-stateOld(is))*sfr(is)*(1-snowFrac(is)),Precip*sfr(is)</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;      <span class="comment">!  write(*,*)  changSnow(is),runoff(is),ev,chang(is),runoffTest,FreezState(is) !changSnow(is)-freezMelt(is)</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;      <span class="comment">!  write(*,*)  is,Precip,runoff_per_tstep,ev_per_tstep,surf_chang_per_tstep,chSnow_per_interval</span></div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      <span class="comment">!  write(*,*)  is,Precip-runoff_per_tstep-ev_per_tstep,surf_chang_per_tstep+chSnow_per_interval</span></div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      <span class="comment">!  write(*,*)  is,snowFrac(is),sfr(is),sfr(is)*ev_snow(is)</span></div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;      <span class="comment">!  pause</span></div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;      <span class="comment">! endif</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;      <span class="comment">!Only now update the new snow fractions both in the case that snow existing already on ground</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;      <span class="comment">!and snow forms at the current timestep</span></div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;      <span class="keywordflow">IF</span> (snowfracfresh1 &gt; 0) snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowfracfresh1</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;      <span class="keywordflow">IF</span> (snowfracfresh2 &gt; 0) snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowfracfresh2</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;      <span class="comment">!Calculate new snow fraction here.</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;      <span class="comment">!TÃ¤ssÃ¤ ongelmana ettÃ¤ snow fraction muuttuu vain kun on sulamisvettÃ¤ ja on vika tunti.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;      <span class="comment">!TÃ¤mÃ¤ ei juuri koskaan toteudu johtuen lÃ¤mpÃ¶tilan vuorokausisyklistÃ¤</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;      <span class="comment">!Kokeile tÃ¤ssÃ¤ ajaa kahdella tavalla 1) ei tarvita Mw:tÃ¤</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;      <span class="comment">!                                    2) pÃ¤ivitys voi tapahtua millon vain</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;      <span class="comment">!if (SnowFractionChoice==2.and.imin==(nsh_real-1)/nsh_real*60) then</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#afb1d5c1c466c1cb87fcf8548322581a1">snowfractionchoice</a> == 2) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;         <span class="keywordflow">IF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0 .AND. mw_ind(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;            snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = snowdepletioncurve(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>, snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>), snowpacklimit<span class="comment">(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>))</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;<span class="comment"></span>            <span class="keywordflow">IF</span> (snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0.001) snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0.001  <span class="comment">!The snow fraction minimum is 1% of the surface</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;         <span class="keywordflow">ELSEIF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) == 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;            snowfrac(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = 0</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160; </div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;      <span class="keywordflow">RETURN</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160; </div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;      <span class="comment">!==========================================================================</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;      <span class="comment">!WATERBODY is treated separately as state_id always below ice if ice existing</span></div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;      <span class="comment">!Calculate change in SnowPack</span></div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;606   changsnow(watersurf) = (precip + freezmelt(watersurf) + freezstate<span class="comment">(watersurf)) - &amp;</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;<span class="comment"></span>                             (mw_ind(watersurf) + ev_snow(watersurf))</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160; </div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;      snowpack(watersurf) = snowpack(watersurf) + changsnow(watersurf) <span class="comment">!Update SnowPack</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;      state_id(watersurf) = state_id(watersurf) + <a class="code" href="namespacesues__data.html#a608895dc2e525111cf29781880c92247">flowchange</a> - freezstate<span class="comment">(watersurf)  !Update state_id below ice</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;      <span class="comment">!If SnowPack exists</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;      <span class="keywordflow">IF</span> (snowpack(watersurf) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160; </div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;         <span class="comment">!Add melted water to meltstore and freeze water according to freezMelt(is)</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;         snowwater(watersurf) = snowwater(watersurf) + mw_ind(watersurf)<span class="comment"> - freezmelt(watersurf)</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;         <span class="comment">!Calculate water holding capacity (FWC: Valeo and Ho, 2004) of the SnowPack</span></div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;         fwc = <a class="code" href="namespacesnowmod.html#a7eb3b7cf48a254f8a7b89dfcfcf5288d">waterholdcapfrac</a>*snowpack(watersurf)</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;         <span class="comment">!If FWC is exceeded, add meltwater to state_id</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;         <span class="keywordflow">IF</span> (snowwater(watersurf) &gt;= fwc .AND. temp_c &gt;= 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            state_id(watersurf) = state_id(watersurf) + (snowwater(watersurf<span class="comment">) - fwc)</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment"></span>            snowwater(watersurf) = fwc</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160; </div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;         <span class="comment">!If SnowPack is negative, it melts at this timestep</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;      <span class="keywordflow">ELSEIF</span> (snowpack(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;         <span class="comment">!Add water to the meltwater store</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;         <span class="comment">!If freezing meltwater inside this hour, remove it from the SnowWater</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;         snowwater(watersurf) = snowwater(watersurf) - freezmelt(watersurf<span class="comment">) &amp;</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;<span class="comment"></span>                                + mw_ind(watersurf)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;         state_id(watersurf) = state_id(watersurf) + snowwater(watersurf<span class="comment">) + snowpack(watersurf) !Add meltwater to state_id</span></div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;         snowpack(watersurf) = 0</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;         <span class="keywordflow">IF</span> (state_id(watersurf) &lt; 0) ev_snow(watersurf) = ev_snow(watersurf<span class="comment">) + state_id(watersurf)</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;<span class="keywordflow">      ENDIF</span> <span class="comment">!SnowPack negative or positive</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;      <span class="comment">!Check water state_id separately</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;      <span class="keywordflow">IF</span> (state_id(watersurf) &gt; storedrainprm(5, watersurf)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;         runoff(watersurf) = runoff(watersurf) + (state_id(watersurf) - storedrainprm<span class="comment">(5, watersurf))</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;<span class="comment"></span>         state_id(watersurf) = storedrainprm(5, watersurf)</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;         <a class="code" href="namespacesues__data.html#ac5b39f5ccfae7334ddd13a7d706cb9ee">runoffwaterbody</a> = <a class="code" href="namespacesues__data.html#ac5b39f5ccfae7334ddd13a7d706cb9ee">runoffwaterbody</a> + runoff(watersurf)*sfr(watersurf<span class="comment">)</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;<span class="comment"></span>      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;         state_id(watersurf) = state_id(watersurf) + <a class="code" href="namespacesues__data.html#a1e694c72624ccedb43be069e4764237d">surpluswaterbody</a></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160; </div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;         <span class="keywordflow">IF</span> (state_id(watersurf) &gt; storedrainprm(5, watersurf)) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <a class="code" href="namespacesues__data.html#ac5b39f5ccfae7334ddd13a7d706cb9ee">runoffwaterbody</a> = <a class="code" href="namespacesues__data.html#ac5b39f5ccfae7334ddd13a7d706cb9ee">runoffwaterbody</a> + (state_id(watersurf) - storedrainprm<span class="comment">(5, watersurf))*sfr(watersurf)</span></div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;<span class="comment"></span>            state_id(watersurf) = storedrainprm(5, watersurf)</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160; </div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;      <span class="comment">!Change state_id of snow and surface</span></div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;      chsnow_tot = ((snowpack(watersurf) + snowwater(watersurf)) - snowtotinit<span class="comment">)*sfr(watersurf)</span></div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;<span class="comment"></span>      <span class="comment">!ch_per_interval=ch_per_interval+(state_id(WaterSurf)-stateOld(WaterSurf))*sfr(WaterSurf)</span></div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;      surf_chang_tot = (state_id(watersurf) - stateold(watersurf))*sfr(watersurf<span class="comment">)</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;      <span class="comment">!Evaporation</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;      ev_tot = <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>*sfr(watersurf) + ev_snow(watersurf)*sfr(watersurf)</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;      qe_tot = ev_snow(watersurf)*<a class="code" href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">tlv_sub</a>*sfr(watersurf) + <a class="code" href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">ev</a>*<a class="code" href="namespacemoist.html#ab532226ee34f5b2568b9974a694da3a6">tlv</a>*sfr(watersurf<span class="comment">)</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;<span class="comment"></span>      runoff_tot = runoff(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) <span class="comment">!The total runoff from the area</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160; </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;      <span class="keywordflow">IF</span> (snowpack(watersurf) &gt; 0) <span class="keywordflow">THEN</span>     <span class="comment">!Fraction only 1 or 0</span></div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;         snowfrac(watersurf) = 1</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;         snowfrac(watersurf) = 0</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="suews__phys__evap_8f95_source.html#l00005">evap_suews()</a>, <a class="el" href="suews__phys__snow_8f95_source.html#l01128">evap_suews_snow()</a>, <a class="el" href="suews__phys__snow_8f95_source.html#l01216">snowdepletioncurve()</a>, <a class="el" href="suews__phys__snow_8f95_source.html#l01187">snowrem()</a>, and <a class="el" href="suews__phys__waterdist_8f95_source.html#l00399">waterdist_module::updateflood()</a>.</p>

<p class="reference">Referenced by <a class="el" href="suews__ctrl__driver_8f95_source.html#l01477">suews_driver::suews_cal_qe()</a>.</p>

</div>
</div>
<a id="a3574cc96d5500ebbcc98deedd05c5081"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3574cc96d5500ebbcc98deedd05c5081">&#9670;&nbsp;</a></span>snowdepletioncurve()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">real(kind(1d0)) function snow_module::snowdepletioncurve </td>
          <td>(</td>
          <td class="paramtype">integer&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0))&#160;</td>
          <td class="paramname"><em>swe</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0))&#160;</td>
          <td class="paramname"><em>sweD</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l01216">1216</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;      <span class="comment">!This function calculates surface coverage of snow according to the</span></div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;      <span class="comment">!depletion curves in Valeo and Ho (2004).</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;      <span class="comment">!INPUT: is   Surface type number</span></div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      <span class="comment">!       swe  Snow water content</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="comment">!       sweD Limit for</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160; </div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;      <span class="keywordtype">USE </span><a class="code" href="namespaceallocatearray.html">allocatearray</a></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160; </div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;      <span class="keywordtype">INTEGER</span>::is</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0))::asc, sweD, swe</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160; </div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;      <span class="comment">!Impervious surface</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == <a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160; </div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a> &lt;= swed) <span class="keywordflow">THEN</span>      <span class="comment">!Snow water equivalent below threshold</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;            asc = ((<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a>/swed))**2</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;         <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;            asc = 1</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160; </div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;         <span class="comment">!Bldgs surface</span></div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;      <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == <a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160; </div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a> &lt;= swed) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;            <span class="keywordflow">IF</span> ((<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a>/swed) &lt; 0.9) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;               asc = (<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a>/swed)*0.5</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;            <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;               asc = (<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a>/swed)**8</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;<span class="keywordflow">            ENDIF</span></div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;         <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;            asc = 1</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;      <span class="keywordflow">ELSEIF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == <a class="code" href="namespaceallocatearray.html#ab7209655ef0719802efdbd710dc3e1dd">watersurf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a> &gt; 0) asc = 1</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160; </div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;         <span class="comment">!Vegetion surfaces</span></div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a> &lt;= swed) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160; </div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;            asc = 1 - ((1/3.1416)*acos(2*(<a class="code" href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">swe</a>/swed) - 1))**1.7</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;         <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;            asc = 1</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160; </div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160; </div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;      <span class="comment">!asc=real(int(10000.*asc))/10000  !4 decimal precision</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160; </div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;      <span class="keywordflow">RETURN</span></div>
</div><!-- fragment -->
<p class="reference">References <a class="el" href="suews__ctrl__const_8f95_source.html#l00186">allocatearray::bldgsurf</a>, <a class="el" href="suews__ctrl__const_8f95_source.html#l00186">allocatearray::pavsurf</a>, and <a class="el" href="suews__ctrl__const_8f95_source.html#l00186">allocatearray::watersurf</a>.</p>

<p class="reference">Referenced by <a class="el" href="suews__phys__snow_8f95_source.html#l00469">snowcalc()</a>.</p>

</div>
</div>
<a id="a64ee5568c224c9861096d3a094032a33"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a64ee5568c224c9861096d3a094032a33">&#9670;&nbsp;</a></span>snowrem()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::snowrem </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>is</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>PavSurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>BldgSurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>snowfrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>SnowPack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(out)&#160;</td>
          <td class="paramname"><em>SnowRemoval</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowLimPaved</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowLimBldg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l01187">1187</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160; </div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>                          :: is, PavSurf, BldgSurf<span class="comment">, nsurf</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;<span class="comment"></span><span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span> :: snowfrac, sfr</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(out)</span>:: SnowPack, SnowRemoval</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(in)</span>                  :: SnowLimPaved, SnowLimBldg</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;      <span class="comment">!write(*,*) is, SnowPack(is),SnowLimPaved,SnowLimBldg</span></div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160; </div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == <a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>) &gt; <a class="code" href="namespacesnowmod.html#a23247e3b94ab1e3b9076144680243d62">snowlimpaved</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;            <a class="code" href="namespacesnowmod.html#a9c7d574d109596d16542b38123065e66">snowremoval</a>(<a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>) = (<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>) - <a class="code" href="namespacesnowmod.html#a23247e3b94ab1e3b9076144680243d62">snowlimpaved</a>)*<a class="code" href="namespaceallocatearray.html#a22ef94e8f1becc739e9945560050c844">sfr</a><span class="comment">(<a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>)*<a class="code" href="namespaceallocatearray.html#afddcfa297d34e2f62378a4de75940afb">snowfrac</a>(<a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>)</span></div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;<span class="comment"></span>            <a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">pavsurf</a>) = <a class="code" href="namespacesnowmod.html#a23247e3b94ab1e3b9076144680243d62">snowlimpaved</a></div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;            <span class="comment">!SnowPack(PavSurf)=SnowPack(PavSurf)/snowFrac(PavSurf)</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;      <span class="keywordflow">IF</span> (<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> == <a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a>) &gt; <a class="code" href="namespacesnowmod.html#aa93dd6da6254734639979ed6869b519a">snowlimbldg</a>) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;            <a class="code" href="namespacesnowmod.html#a9c7d574d109596d16542b38123065e66">snowremoval</a>(2) = (<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a>) - <a class="code" href="namespacesnowmod.html#aa93dd6da6254734639979ed6869b519a">snowlimbldg</a>)*<a class="code" href="namespaceallocatearray.html#a22ef94e8f1becc739e9945560050c844">sfr</a>(<a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a><span class="comment">)*<a class="code" href="namespaceallocatearray.html#afddcfa297d34e2f62378a4de75940afb">snowfrac</a>(<a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a>)</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;<span class="comment"></span>            <a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">bldgsurf</a>) = <a class="code" href="namespacesnowmod.html#aa93dd6da6254734639979ed6869b519a">snowlimbldg</a></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;            <span class="comment">!SnowPack(BldgSurf)=SnowPack(BldgSurf)/snowFrac(BldgSurf)</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;      <span class="comment">!write(*,*) is, SnowPack(is),SnowLimPaved,SnowLimBldg</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;      <span class="comment">!pause</span></div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="suews__phys__snow_8f95_source.html#l00469">snowcalc()</a>.</p>

</div>
</div>
<a id="ab714d5ea93ac72f7826b043c6d1bf790"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab714d5ea93ac72f7826b043c6d1bf790">&#9670;&nbsp;</a></span>snowupdate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::snowupdate </td>
          <td>(</td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>tstep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>Temp_C_hr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>tau_a</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>tau_f</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>tau_r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowDensMax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowDensMin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowAlbMax</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(in)&#160;</td>
          <td class="paramname"><em>SnowAlbMin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>SnowPack</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowAlb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(inout)&#160;</td>
          <td class="paramname"><em>SnowDens</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l01309">1309</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160; </div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160; </div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::nsurf</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span>::tstep</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::Temp_C_hr        <span class="comment">!Air temperature</span></div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::tau_a</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::tau_f</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::tau_r</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::SnowDensMax</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::SnowDensMin</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::SnowAlbMax</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0)), <span class="keywordtype">INTENT(in)</span>::SnowAlbMin</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160; </div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span>::SnowPack</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160; </div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(inout)</span>::SnowAlb</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160; </div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(inout)</span>::SnowDens</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;      <span class="keywordtype">INTEGER</span>::is</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1D0))::alb_change, &amp;     <span class="comment">!Change in snow albedo</span></div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;                        dens_change, &amp;    <span class="comment">!Change in snow density</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;                        tau_1         <span class="comment">!Number of seconds in a day</span></div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160; </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;      <span class="comment">!Initialize</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;      alb_change = 0</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;      dens_change = 0</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;      tau_1 = 24*60*60</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160; </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;      <span class="comment">!==========================================================</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;      <span class="comment">!Calculation of snow albedo by Lemonsu et al. 2010</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;      <span class="comment">!(org: Verseghy (1991)&amp;Baker et al.(1990))</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;      <span class="keywordflow">IF</span> (sum(<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>) &gt; 0) <span class="keywordflow">THEN</span> <span class="comment">!Check if snow on any of the surfaces</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;         <span class="keywordflow">IF</span> (temp_c_hr &lt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            <span class="comment">!alb_change = tau_a*(60*60)/tau_1</span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            alb_change = <a class="code" href="namespacesnowmod.html#aed7a5f50c4d3f71862bc57d480bcf4d7">tau_a</a>*(<a class="code" href="namespacesues__data.html#ac6af955be55f5fe026b4ba1ab6ec480e">tstep</a>)/tau_1</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> = <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> - alb_change</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;         <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            <span class="comment">!alb_change = exp(-tau_f*(60*60)/tau_1)</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            alb_change = exp(-<a class="code" href="namespacesnowmod.html#af2d1865ccc784420d8b4c05d87731856">tau_f</a>*(<a class="code" href="namespacesues__data.html#ac6af955be55f5fe026b4ba1ab6ec480e">tstep</a>)/tau_1)</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> = (<a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> - <a class="code" href="namespacesnowmod.html#aabc7b0d3b24826919d235a6452436d80">snowalbmin</a>)*alb_change + <a class="code" href="namespacesnowmod.html#aabc7b0d3b24826919d235a6452436d80">snowalbmin</a></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> &lt; <a class="code" href="namespacesnowmod.html#aabc7b0d3b24826919d235a6452436d80">snowalbmin</a>) <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> = <a class="code" href="namespacesnowmod.html#aabc7b0d3b24826919d235a6452436d80">snowalbmin</a> <span class="comment">!Albedo cannot be smaller than the min albedo</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> &gt; <a class="code" href="namespacesnowmod.html#a2dd094889525c7d4073c124bb54b634c">snowalbmax</a>) <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> = <a class="code" href="namespacesnowmod.html#a2dd094889525c7d4073c124bb54b634c">snowalbmax</a> <span class="comment">!Albedo cannot be larger than the max albedo</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;         <span class="keywordflow">if</span> (<a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> &lt; 0) print *, <span class="stringliteral">&#39;SnowAlbMin/max in SnowUpdate&#39;</span>, <a class="code" href="namespacesnowmod.html#aabc7b0d3b24826919d235a6452436d80">snowalbmin</a><span class="comment">, <a class="code" href="namespacesnowmod.html#a2dd094889525c7d4073c124bb54b634c">snowalbmax</a>, <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a></span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment"></span>      <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;         <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> = 0</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="keywordflow">      ENDIF</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a> &lt; 0) print *, <span class="stringliteral">&#39;SnowAlb in SnowUpdate&#39;</span>, <a class="code" href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowalb</a></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160; </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;      <span class="comment">!Update snow density: There is a mistake in JÃ¤rvi et al. (2014): tau_h should be tau_1</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;      <span class="keywordflow">DO</span> <a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a> = 1, <a class="code" href="namespaceallocatearray.html#acd22f92a06f7e9a2a91426b3dc99fdb0">nsurf</a></div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;         <span class="comment">!If SnowPack existing</span></div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;         <span class="keywordflow">IF</span> (<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <span class="keywordflow">THEN</span></div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            dens_change = exp(-<a class="code" href="namespacesnowmod.html#a5739710e091db0d14c07c9fd0e0d937d">tau_r</a>*(<a class="code" href="namespacesues__data.html#ac6af955be55f5fe026b4ba1ab6ec480e">tstep</a>)/tau_1)</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;            <span class="keywordflow">IF</span> (<a class="code" href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">snowpack</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; 0) <a class="code" href="namespaceallocatearray.html#ac7b06ad52874f40a2c456863ffa3d262">snowdens</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = (<a class="code" href="namespaceallocatearray.html#ac7b06ad52874f40a2c456863ffa3d262">snowdens</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) - <a class="code" href="namespacesnowmod.html#ad2da7c4134f7b908c3190819cecd004f">snowdensmax</a><span class="comment">)*dens_change + <a class="code" href="namespacesnowmod.html#ad2da7c4134f7b908c3190819cecd004f">snowdensmax</a></span></div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;<span class="comment"></span>            <span class="keywordflow">IF</span> (<a class="code" href="namespaceallocatearray.html#ac7b06ad52874f40a2c456863ffa3d262">snowdens</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) &gt; <a class="code" href="namespacesnowmod.html#ad2da7c4134f7b908c3190819cecd004f">snowdensmax</a>) <a class="code" href="namespaceallocatearray.html#ac7b06ad52874f40a2c456863ffa3d262">snowdens</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#ad2da7c4134f7b908c3190819cecd004f">snowdensmax</a></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;         <span class="keywordflow">ELSE</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;            <a class="code" href="namespaceallocatearray.html#ac7b06ad52874f40a2c456863ffa3d262">snowdens</a>(<a class="code" href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">is</a>) = <a class="code" href="namespacesnowmod.html#aa8834b111a576d48e70825463fae599f">snowdensmin</a></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="keywordflow">         ENDIF</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="keywordflow">      ENDDO</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="suews__phys__dailystate_8f95_source.html#l00073">dailystate_module::suews_cal_dailystate()</a>.</p>

</div>
</div>
<a id="a06e219e41fda843664a95853a632ec11"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a06e219e41fda843664a95853a632ec11">&#9670;&nbsp;</a></span>veg_fr_snow()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subroutine snow_module::veg_fr_snow </td>
          <td>(</td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>sfr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), dimension(nsurf), intent(in)&#160;</td>
          <td class="paramname"><em>snowFrac</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">integer, intent(in)&#160;</td>
          <td class="paramname"><em>nsurf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">real(kind(1d0)), intent(out)&#160;</td>
          <td class="paramname"><em>veg_fr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">nsurf</td><td>number of surface types</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sfr</td><td>surface fractions</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">snowfrac</td><td>snowy surface fractions [-]</td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">veg_fr</td><td>vegetated surface fractions [-] </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="suews__phys__snow_8f95_source.html#l01272">1272</a> of file <a class="el" href="suews__phys__snow_8f95_source.html">suews_phys_snow.f95</a>.</p>
<div class="fragment"><div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;      <span class="keywordtype">IMPLICIT NONE</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160; </div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;      <span class="keywordtype">INTEGER</span>, <span class="keywordtype">INTENT(in)</span> :: nsurf</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160; </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span> :: sfr</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">DIMENSION(nsurf)</span>, <span class="keywordtype">INTENT(in)</span> :: snowFrac</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160; </div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;<span class="keywordtype">      REAL</span>(KIND(1d0)), <span class="keywordtype">INTENT(out)</span> :: veg_fr</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160; </div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;      veg_fr = dot_product(<a class="code" href="namespaceallocatearray.html#a22ef94e8f1becc739e9945560050c844">sfr</a>(3:7), 1 - <a class="code" href="namespaceallocatearray.html#afddcfa297d34e2f62378a4de75940afb">snowfrac</a>(3:7))</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160; </div>
</div><!-- fragment -->
<p class="reference">Referenced by <a class="el" href="suews__phys__snow_8f95_source.html#l00040">snow_cal_meltheat()</a>.</p>

</div>
</div>
</div><!-- contents -->
<div class="ttc" id="anamespacesnowmod_html_a23247e3b94ab1e3b9076144680243d62"><div class="ttname"><a href="namespacesnowmod.html#a23247e3b94ab1e3b9076144680243d62">snowmod::snowlimpaved</a></div><div class="ttdeci">real(kind(1d0)) snowlimpaved</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_acdb318490531b8ec4ada9690378f1ba1"><div class="ttname"><a href="namespaceallocatearray.html#acdb318490531b8ec4ada9690378f1ba1">allocatearray::pavsurf</a></div><div class="ttdeci">integer, parameter pavsurf</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00186">suews_ctrl_const.f95:186</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_afb1d5c1c466c1cb87fcf8548322581a1"><div class="ttname"><a href="namespacesnowmod.html#afb1d5c1c466c1cb87fcf8548322581a1">snowmod::snowfractionchoice</a></div><div class="ttdeci">integer snowfractionchoice</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01277">suews_ctrl_const.f95:1277</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_adf202899dbee650b6c4a30eeeedd56a1"><div class="ttname"><a href="namespacesnowmod.html#adf202899dbee650b6c4a30eeeedd56a1">snowmod::snowalb</a></div><div class="ttdeci">real(kind(1d0)) snowalb</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a7eb3b7cf48a254f8a7b89dfcfcf5288d"><div class="ttname"><a href="namespacesnowmod.html#a7eb3b7cf48a254f8a7b89dfcfcf5288d">snowmod::waterholdcapfrac</a></div><div class="ttdeci">real(kind(1d0)) waterholdcapfrac</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacemoist_html_ab532226ee34f5b2568b9974a694da3a6"><div class="ttname"><a href="namespacemoist.html#ab532226ee34f5b2568b9974a694da3a6">moist::tlv</a></div><div class="ttdeci">real(kind(1d0)) tlv</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a7243763d809e4a91d9098fbdafe567ff"><div class="ttname"><a href="namespacesnowmod.html#a7243763d809e4a91d9098fbdafe567ff">snowmod::tempmeltfact</a></div><div class="ttdeci">real(kind(1d0)) tempmeltfact</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a03427875dc6d97e948ea500b3373a5ac"><div class="ttname"><a href="namespacesnowmod.html#a03427875dc6d97e948ea500b3373a5ac">snowmod::snowfallcum</a></div><div class="ttdeci">real(kind(1d0)) snowfallcum</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_ab2070158f8b88b8f7835232841061718"><div class="ttname"><a href="namespacesues__data.html#ab2070158f8b88b8f7835232841061718">sues_data::nsh_real</a></div><div class="ttdeci">real(kind(1d0)) nsh_real</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01433">suews_ctrl_const.f95:1433</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_acd22f92a06f7e9a2a91426b3dc99fdb0"><div class="ttname"><a href="namespaceallocatearray.html#acd22f92a06f7e9a2a91426b3dc99fdb0">allocatearray::nsurf</a></div><div class="ttdeci">integer, parameter nsurf</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00182">suews_ctrl_const.f95:182</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_abb6cc208c99b46f7941fe721aa6c1d7c"><div class="ttname"><a href="namespacesnowmod.html#abb6cc208c99b46f7941fe721aa6c1d7c">snowmod::mwstore</a></div><div class="ttdeci">real(kind(1d0)) mwstore</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a117020f6d033ab298e21ee51111c6ea9"><div class="ttname"><a href="namespacesnowmod.html#a117020f6d033ab298e21ee51111c6ea9">snowmod::lvs_j_kg</a></div><div class="ttdeci">real(kind(1d0)) lvs_j_kg</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacemeteo_html_ad97f553e69dd6efff67ba4cafdbb02f2"><div class="ttname"><a href="namespacemeteo.html#ad97f553e69dd6efff67ba4cafdbb02f2">meteo::sat_vap_pressice</a></div><div class="ttdeci">real(kind(1d0)) function sat_vap_pressice(Temp_c, PRESS_hPa, from, dectime)</div><div class="ttdef"><b>Definition:</b> <a href="suews__util__meteo_8f95_source.html#l00196">suews_util_meteo.f95:196</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a86ec9ab7c91a487eda8cda6d95879652"><div class="ttname"><a href="namespacesnowmod.html#a86ec9ab7c91a487eda8cda6d95879652">snowmod::qm</a></div><div class="ttdeci">real(kind(1d0)) qm</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html"><div class="ttname"><a href="namespaceallocatearray.html">allocatearray</a></div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00018">suews_ctrl_const.f95:18</a></div></div>
<div class="ttc" id="anamespacesues__data_html_af52acc52e5d46d875f504d1788e8e548"><div class="ttname"><a href="namespacesues__data.html#af52acc52e5d46d875f504d1788e8e548">sues_data::runoffpipes</a></div><div class="ttdeci">real(kind(1d0)) runoffpipes</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a81a241a978fdd040dee716c4e68dc786"><div class="ttname"><a href="namespacesues__data.html#a81a241a978fdd040dee716c4e68dc786">sues_data::tstep_real</a></div><div class="ttdeci">real(kind(1d0)) tstep_real</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01433">suews_ctrl_const.f95:1433</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a2dd094889525c7d4073c124bb54b634c"><div class="ttname"><a href="namespacesnowmod.html#a2dd094889525c7d4073c124bb54b634c">snowmod::snowalbmax</a></div><div class="ttdeci">real(kind(1d0)) snowalbmax</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a4a6bc9911d35670ae9e4867ea2476fc4"><div class="ttname"><a href="namespacesues__data.html#a4a6bc9911d35670ae9e4867ea2476fc4">sues_data::rb</a></div><div class="ttdeci">real(kind(1d0)) rb</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_aa8834b111a576d48e70825463fae599f"><div class="ttname"><a href="namespacesnowmod.html#aa8834b111a576d48e70825463fae599f">snowmod::snowdensmin</a></div><div class="ttdeci">real(kind(1d0)) snowdensmin</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_af5f7c82ab6625c3e67be5fac8829bcd2"><div class="ttname"><a href="namespacesnowmod.html#af5f7c82ab6625c3e67be5fac8829bcd2">snowmod::preciplimit</a></div><div class="ttdeci">real(kind(1d0)) preciplimit</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a98b7fc0f23539e7f56ea37af0daa8ea4"><div class="ttname"><a href="namespacesues__data.html#a98b7fc0f23539e7f56ea37af0daa8ea4">sues_data::pipecapacity</a></div><div class="ttdeci">real(kind(1d0)) pipecapacity</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01456">suews_ctrl_const.f95:1456</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_af2d1865ccc784420d8b4c05d87731856"><div class="ttname"><a href="namespacesnowmod.html#af2d1865ccc784420d8b4c05d87731856">snowmod::tau_f</a></div><div class="ttdeci">real(kind(1d0)) tau_f</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a12712df2a3ef0b83f2e599caf2b9a751"><div class="ttname"><a href="namespacesues__data.html#a12712df2a3ef0b83f2e599caf2b9a751">sues_data::ra</a></div><div class="ttdeci">real(kind(1d0)) ra</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01520">suews_ctrl_const.f95:1520</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a608895dc2e525111cf29781880c92247"><div class="ttname"><a href="namespacesues__data.html#a608895dc2e525111cf29781880c92247">sues_data::flowchange</a></div><div class="ttdeci">real(kind(1d0)) flowchange</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01456">suews_ctrl_const.f95:1456</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_afddcfa297d34e2f62378a4de75940afb"><div class="ttname"><a href="namespaceallocatearray.html#afddcfa297d34e2f62378a4de75940afb">allocatearray::snowfrac</a></div><div class="ttdeci">real(kind(1d0)), dimension(nsurf) snowfrac</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00401">suews_ctrl_const.f95:401</a></div></div>
<div class="ttc" id="anamespacesues__data_html_ac5b39f5ccfae7334ddd13a7d706cb9ee"><div class="ttname"><a href="namespacesues__data.html#ac5b39f5ccfae7334ddd13a7d706cb9ee">sues_data::runoffwaterbody</a></div><div class="ttdeci">real(kind(1d0)) runoffwaterbody</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacemoist_html_a06b3a1e3aa06034efaad2df61b59f28d"><div class="ttname"><a href="namespacemoist.html#a06b3a1e3aa06034efaad2df61b59f28d">moist::s_hpa</a></div><div class="ttdeci">real(kind(1d0)) s_hpa</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacesues__data_html_aeafc4cc2008ab8f39387e34d938422ff"><div class="ttname"><a href="namespacesues__data.html#aeafc4cc2008ab8f39387e34d938422ff">sues_data::runoffagveg</a></div><div class="ttdeci">real(kind(1d0)) runoffagveg</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a7a94f65676b945fe1bdd885be299e967"><div class="ttname"><a href="namespacesues__data.html#a7a94f65676b945fe1bdd885be299e967">sues_data::tlv_sub</a></div><div class="ttdeci">real(kind(1d0)) tlv_sub</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a2f655017a75f9dc31500f86bbd985399"><div class="ttname"><a href="namespacesnowmod.html#a2f655017a75f9dc31500f86bbd985399">snowmod::adjmeltfact</a></div><div class="ttdeci">real(kind(1d0)) adjmeltfact</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacemoist_html_a5a7cfba4c3c7fd580026b89d923b61df"><div class="ttname"><a href="namespacemoist.html#a5a7cfba4c3c7fd580026b89d923b61df">moist::psyc_hpa</a></div><div class="ttdeci">real(kind(1d0)) psyc_hpa</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a8a86e8b1f4de8e8447c4fc264c910bd4"><div class="ttname"><a href="namespacesnowmod.html#a8a86e8b1f4de8e8447c4fc264c910bd4">snowmod::mwh</a></div><div class="ttdeci">real(kind(1d0)) mwh</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacewaterdist__module_html"><div class="ttname"><a href="namespacewaterdist__module.html">waterdist_module</a></div><div class="ttdef"><b>Definition:</b> <a href="suews__phys__waterdist_8f95_source.html#l00001">suews_phys_waterdist.f95:1</a></div></div>
<div class="ttc" id="anamespacemeteo_html"><div class="ttname"><a href="namespacemeteo.html">meteo</a></div><div class="ttdef"><b>Definition:</b> <a href="suews__util__meteo_8f95_source.html#l00002">suews_util_meteo.f95:2</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a53e675abb512cd7e7ee673dd03911a54"><div class="ttname"><a href="namespacesnowmod.html#a53e675abb512cd7e7ee673dd03911a54">snowmod::qmrain</a></div><div class="ttdeci">real(kind(1d0)) qmrain</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_ac6af955be55f5fe026b4ba1ab6ec480e"><div class="ttname"><a href="namespacesues__data.html#ac6af955be55f5fe026b4ba1ab6ec480e">sues_data::tstep</a></div><div class="ttdeci">integer tstep</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01425">suews_ctrl_const.f95:1425</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a17abf76009d5444c277c504419efacdd"><div class="ttname"><a href="namespacesnowmod.html#a17abf76009d5444c277c504419efacdd">snowmod::fwh</a></div><div class="ttdeci">real(kind(1d0)) fwh</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a37a51eae2e92c0d594b8f2acbf8e2a7c"><div class="ttname"><a href="namespacesnowmod.html#a37a51eae2e92c0d594b8f2acbf8e2a7c">snowmod::radmeltfact</a></div><div class="ttdeci">real(kind(1d0)) radmeltfact</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacemoist_html_a97ebb391a868ba97ccc33c10117c8706"><div class="ttname"><a href="namespacemoist.html#a97ebb391a868ba97ccc33c10117c8706">moist::lv_j_kg</a></div><div class="ttdeci">real(kind(1d0)) lv_j_kg</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a9c7d574d109596d16542b38123065e66"><div class="ttname"><a href="namespacesnowmod.html#a9c7d574d109596d16542b38123065e66">snowmod::snowremoval</a></div><div class="ttdeci">real(kind(1d0)), dimension(2) snowremoval</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01274">suews_ctrl_const.f95:1274</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_aa93dd6da6254734639979ed6869b519a"><div class="ttname"><a href="namespacesnowmod.html#aa93dd6da6254734639979ed6869b519a">snowmod::snowlimbldg</a></div><div class="ttdeci">real(kind(1d0)) snowlimbldg</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a38a6478771abe06a6cf4334fe858c0ef"><div class="ttname"><a href="namespacesues__data.html#a38a6478771abe06a6cf4334fe858c0ef">sues_data::is</a></div><div class="ttdeci">integer is</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01444">suews_ctrl_const.f95:1444</a></div></div>
<div class="ttc" id="anamespacemoist_html_a907186a43d25a5ed890b202141c1400a"><div class="ttname"><a href="namespacemoist.html#a907186a43d25a5ed890b202141c1400a">moist::vpd_hpa</a></div><div class="ttdeci">real(kind(1d0)) vpd_hpa</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacetime_html_acf0bd1b102769fcbe36a171b4b9e2a25"><div class="ttname"><a href="namespacetime.html#acf0bd1b102769fcbe36a171b4b9e2a25">time::dectime</a></div><div class="ttdeci">real(kind(1d0)) dectime</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01300">suews_ctrl_const.f95:1300</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a32d5aa6f8ce1907e4a4cfea8cd7e1119"><div class="ttname"><a href="namespacesues__data.html#a32d5aa6f8ce1907e4a4cfea8cd7e1119">sues_data::runoffagimpervious</a></div><div class="ttdeci">real(kind(1d0)) runoffagimpervious</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a98c579aa36901f7c40f5a7736337bb21"><div class="ttname"><a href="namespacesues__data.html#a98c579aa36901f7c40f5a7736337bb21">sues_data::addimpervious</a></div><div class="ttdeci">real(kind(1d0)) addimpervious</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_aed7a5f50c4d3f71862bc57d480bcf4d7"><div class="ttname"><a href="namespacesnowmod.html#aed7a5f50c4d3f71862bc57d480bcf4d7">snowmod::tau_a</a></div><div class="ttdeci">real(kind(1d0)) tau_a</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_a0c3675a79f0c6c3921beb95eb4d9d48f"><div class="ttname"><a href="namespaceallocatearray.html#a0c3675a79f0c6c3921beb95eb4d9d48f">allocatearray::snowpack</a></div><div class="ttdeci">real(kind(1d0)), dimension(nsurf) snowpack</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00426">suews_ctrl_const.f95:426</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a0b95abe25d6e77ca8f4b3ba05c3176fa"><div class="ttname"><a href="namespacesnowmod.html#a0b95abe25d6e77ca8f4b3ba05c3176fa">snowmod::snowprof_24hr</a></div><div class="ttdeci">real(kind(1d0)), dimension(0:23, 2) snowprof_24hr</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01275">suews_ctrl_const.f95:1275</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a326ca0cd80d6cd1bdc0cb49352972724"><div class="ttname"><a href="namespacesues__data.html#a326ca0cd80d6cd1bdc0cb49352972724">sues_data::addveg</a></div><div class="ttdeci">real(kind(1d0)) addveg</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacetime_html_a88a6c141593462330d65da0397b9b71d"><div class="ttname"><a href="namespacetime.html#a88a6c141593462330d65da0397b9b71d">time::it</a></div><div class="ttdeci">integer it</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01293">suews_ctrl_const.f95:1293</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a593cb8d2d82b6e80d07831e94c2013dc"><div class="ttname"><a href="namespacesnowmod.html#a593cb8d2d82b6e80d07831e94c2013dc">snowmod::qmfreez</a></div><div class="ttdeci">real(kind(1d0)) qmfreez</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_abe3d3d6bafc04802fe09ca8fd7a5ebb6"><div class="ttname"><a href="namespacesues__data.html#abe3d3d6bafc04802fe09ca8fd7a5ebb6">sues_data::rasnow</a></div><div class="ttdeci">real(kind(1d0)) rasnow</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01520">suews_ctrl_const.f95:1520</a></div></div>
<div class="ttc" id="asuews__phys__evap_8f95_html_a1139f9ab66d71bf517d0e6abc01288c3"><div class="ttname"><a href="suews__phys__evap_8f95.html#a1139f9ab66d71bf517d0e6abc01288c3">evap_suews</a></div><div class="ttdeci">subroutine evap_suews(EvapMethod, state_is, WetThresh_is, capStore_is, vpd_hPa, avdens, avcp, qn_e, s_hPa, psyc_hPa, ResistSurf, RA, rb, tlv, rss, ev, qe)</div><div class="ttdef"><b>Definition:</b> <a href="suews__phys__evap_8f95_source.html#l00005">suews_phys_evap.f95:5</a></div></div>
<div class="ttc" id="anamespacemoist_html_a89fa4260376c2e9b81162b39d0fb2534"><div class="ttname"><a href="namespacemoist.html#a89fa4260376c2e9b81162b39d0fb2534">moist::waterdens</a></div><div class="ttdeci">real(kind(1d0)) waterdens</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_afadc17fdadab7b30932ccc52f50b99df"><div class="ttname"><a href="namespacesnowmod.html#afadc17fdadab7b30932ccc52f50b99df">snowmod::crwmin</a></div><div class="ttdeci">real(kind(1d0)) crwmin</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_aabc7b0d3b24826919d235a6452436d80"><div class="ttname"><a href="namespacesnowmod.html#aabc7b0d3b24826919d235a6452436d80">snowmod::snowalbmin</a></div><div class="ttdeci">real(kind(1d0)) snowalbmin</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_ad2da7c4134f7b908c3190819cecd004f"><div class="ttname"><a href="namespacesnowmod.html#ad2da7c4134f7b908c3190819cecd004f">snowmod::snowdensmax</a></div><div class="ttdeci">real(kind(1d0)) snowdensmax</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a1e694c72624ccedb43be069e4764237d"><div class="ttname"><a href="namespacesues__data.html#a1e694c72624ccedb43be069e4764237d">sues_data::surpluswaterbody</a></div><div class="ttdeci">real(kind(1d0)) surpluswaterbody</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01476">suews_ctrl_const.f95:1476</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a27b202e2bf05cfd178642f06120fda94"><div class="ttname"><a href="namespacesues__data.html#a27b202e2bf05cfd178642f06120fda94">sues_data::resistsurf</a></div><div class="ttdeci">real(kind(1d0)) resistsurf</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01531">suews_ctrl_const.f95:1531</a></div></div>
<div class="ttc" id="anamespacemoist_html_a0b90f7e6761869efa414063f6ef84f6f"><div class="ttname"><a href="namespacemoist.html#a0b90f7e6761869efa414063f6ef84f6f">moist::avcp</a></div><div class="ttdeci">real(kind(1d0)) avcp</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a44d95596182bac1d393bd6e9a30c5f09"><div class="ttname"><a href="namespacesnowmod.html#a44d95596182bac1d393bd6e9a30c5f09">snowmod::crwmax</a></div><div class="ttdeci">real(kind(1d0)) crwmax</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesues__data_html_ab7bde4071e5af515b3bb62e5ff7ac114"><div class="ttname"><a href="namespacesues__data.html#ab7bde4071e5af515b3bb62e5ff7ac114">sues_data::ev</a></div><div class="ttdeci">real(kind(1d0)) ev</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01545">suews_ctrl_const.f95:1545</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_aeed684156ad091acb7a1d49316bd8c39"><div class="ttname"><a href="namespacesnowmod.html#aeed684156ad091acb7a1d49316bd8c39">snowmod::swe</a></div><div class="ttdeci">real(kind(1d0)) swe</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_a5739710e091db0d14c07c9fd0e0d937d"><div class="ttname"><a href="namespacesnowmod.html#a5739710e091db0d14c07c9fd0e0d937d">snowmod::tau_r</a></div><div class="ttdeci">real(kind(1d0)) tau_r</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespacemoist_html_af9212d0e505f0524f70140ff2108f745"><div class="ttname"><a href="namespacemoist.html#af9212d0e505f0524f70140ff2108f745">moist::sice_hpa</a></div><div class="ttdeci">real(kind(1d0)) sice_hpa</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01371">suews_ctrl_const.f95:1371</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_ac7b06ad52874f40a2c456863ffa3d262"><div class="ttname"><a href="namespaceallocatearray.html#ac7b06ad52874f40a2c456863ffa3d262">allocatearray::snowdens</a></div><div class="ttdeci">real(kind(1d0)), dimension(nsurf) snowdens</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00401">suews_ctrl_const.f95:401</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a40beadb93fc947febdfd1c8fcc633a3d"><div class="ttname"><a href="namespacesues__data.html#a40beadb93fc947febdfd1c8fcc633a3d">sues_data::runofftowater</a></div><div class="ttdeci">real(kind(1d0)) runofftowater</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01456">suews_ctrl_const.f95:1456</a></div></div>
<div class="ttc" id="anamespacewaterdist__module_html_aef680604133834b26fdf6b25bfc6bcf0"><div class="ttname"><a href="namespacewaterdist__module.html#aef680604133834b26fdf6b25bfc6bcf0">waterdist_module::updateflood</a></div><div class="ttdeci">subroutine updateflood(is, runoff, sfr, PipeCapacity, RunoffToWater, runoffAGimpervious, surplusWaterBody, runoffAGveg, runoffPipes)</div><div class="ttdef"><b>Definition:</b> <a href="suews__phys__waterdist_8f95_source.html#l00399">suews_phys_waterdist.f95:399</a></div></div>
<div class="ttc" id="anamespacesnowmod_html_abfd7f53c4b8f5fc53745b470eba0303d"><div class="ttname"><a href="namespacesnowmod.html#abfd7f53c4b8f5fc53745b470eba0303d">snowmod::preciplimitalb</a></div><div class="ttdeci">real(kind(1d0)) preciplimitalb</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01242">suews_ctrl_const.f95:1242</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_a22ef94e8f1becc739e9945560050c844"><div class="ttname"><a href="namespaceallocatearray.html#a22ef94e8f1becc739e9945560050c844">allocatearray::sfr</a></div><div class="ttdeci">real(kind(1d0)), dimension(nsurf) sfr</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00199">suews_ctrl_const.f95:199</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_a0bbd67bfc668eb8814d94de0d7d2947b"><div class="ttname"><a href="namespaceallocatearray.html#a0bbd67bfc668eb8814d94de0d7d2947b">allocatearray::bldgsurf</a></div><div class="ttdeci">integer, parameter bldgsurf</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00186">suews_ctrl_const.f95:186</a></div></div>
<div class="ttc" id="anamespaceallocatearray_html_ab7209655ef0719802efdbd710dc3e1dd"><div class="ttname"><a href="namespaceallocatearray.html#ab7209655ef0719802efdbd710dc3e1dd">allocatearray::watersurf</a></div><div class="ttdeci">integer, parameter watersurf</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l00186">suews_ctrl_const.f95:186</a></div></div>
<div class="ttc" id="anamespacesues__data_html_a08d117cca68ee0e84a8b286a038434c6"><div class="ttname"><a href="namespacesues__data.html#a08d117cca68ee0e84a8b286a038434c6">sues_data::surplusevap</a></div><div class="ttdeci">real(kind(1d0)), dimension(2) surplusevap</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01452">suews_ctrl_const.f95:1452</a></div></div>
<div class="ttc" id="anamespacetime_html_a9be08cae4e706325fe3524f4370754cc"><div class="ttname"><a href="namespacetime.html#a9be08cae4e706325fe3524f4370754cc">time::imin</a></div><div class="ttdeci">integer imin</div><div class="ttdef"><b>Definition:</b> <a href="suews__ctrl__const_8f95_source.html#l01293">suews_ctrl_const.f95:1293</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Jul 31 2019 13:25:44 for SUEWS by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
